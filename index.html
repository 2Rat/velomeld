<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#1A5FA8">
  <meta name="description" content="2Rat Radwegemelder â€“ Radverkehrsinfrastruktur erfassen und MÃ¤ngel melden">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Radmelder">
  <title>2Rat Radwegemelder</title>
  <link rel="manifest" href="./manifest.json">
  <link rel="apple-touch-icon" href="data:image/png;base64,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">
  
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/dexie@3/dist/dexie.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
  <style>
/* â”€â”€â”€ 2Rat Radmelder â€“ Stylesheet â”€â”€â”€ */

/* â”€â”€â”€ CSS Variables â”€â”€â”€ */
:root {
  --blue: #1A5FA8;
  --blue-dark: #0E3F73;
  --blue-light: #DDEAF8;
  --green: #2D8C28;
  --green-dark: #1B6B17;
  --green-light: #E0F2DE;
  --gray: #3D4F58;
  --gray-light: #F0F2F4;
  --gray-mid: #8A9BA4;
  --white: #FFFFFF;

  /* Ampelfarben */
  --red: #E00000;
  --red-light: #FFAAAA;
  --yellow: #E5A700;
  --yellow-light: #FFE082;
  --ampel-green: #00A836;
  --ampel-green-light: #A5E6B5;

  --radius-sm: 10px;
  --radius-md: 14px;
  --radius-lg: 20px;
  --radius-xl: 24px;
  --shadow-sm: 0 1px 4px rgba(0,0,0,0.06);
  --shadow-md: 0 2px 12px rgba(0,0,0,0.1);
  --shadow-lg: 0 4px 24px rgba(0,0,0,0.12);

  --font: 'DM Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
}

/* â”€â”€â”€ Reset â”€â”€â”€ */
*, *::before, *::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html, body {
  height: 100%;
  font-family: var(--font);
  color: var(--gray);
  background: var(--gray-light);
  -webkit-font-smoothing: antialiased;
  -webkit-tap-highlight-color: transparent;
  overflow: hidden;
  user-select: none;
}

button {
  font-family: var(--font);
  border: none;
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
}

input, textarea {
  font-family: var(--font);
}

/* â”€â”€â”€ App Container â”€â”€â”€ */
.app {
  height: 100%;
  display: flex;
  flex-direction: column;
  max-width: 480px;
  margin: 0 auto;
  background: var(--white);
  position: relative;
  overflow: hidden;
}

/* â”€â”€â”€ Header â”€â”€â”€ */
.header {
  display: flex;
  align-items: center;
  padding: 12px 16px;
  background: var(--white);
  border-bottom: 1px solid var(--gray-light);
  z-index: 20;
  flex-shrink: 0;
}

.header__logo {
  display: flex;
  align-items: baseline;
  gap: 1px;
  font-weight: 700;
  font-size: 18px;
}

.header__logo-2 { color: var(--blue); }
.header__logo-rat { color: var(--green); }
.header__logo-sub {
  font-size: 12px;
  font-weight: 400;
  color: var(--gray-mid);
  margin-left: 6px;
}

/* â”€â”€â”€ Screens â”€â”€â”€ */
[data-screen] {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: none;
  flex-direction: column;
  z-index: 1;
}

[data-screen].screen--active {
  display: flex;
  z-index: 10;
  animation: screenSlideIn 0.25s ease-out;
}

@keyframes screenSlideIn {
  from {
    opacity: 0;
    transform: translateX(20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

/* â”€â”€â”€ Home Screen â”€â”€â”€ */
.map-container {
  flex: 1;
  min-height: 200px;
  position: relative;
}

#map-container {
  width: 100%;
  height: 100%;
}

.home-bottom {
  background: var(--white);
  border-radius: var(--radius-xl) var(--radius-xl) 0 0;
  padding: 24px 20px 28px;
  box-shadow: 0 -4px 24px rgba(0,0,0,0.08);
  position: relative;
  z-index: 5;
  flex-shrink: 0;
}

.home-bottom__title {
  font-size: 20px;
  font-weight: 700;
  margin-bottom: 4px;
}

.home-bottom__subtitle {
  font-size: 13px;
  color: var(--gray-mid);
  margin-bottom: 18px;
}

/* â”€â”€â”€ Kategorie-Buttons (Home) â”€â”€â”€ */
.cat-btn {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 16px 18px;
  border-radius: var(--radius-md);
  width: 100%;
  text-align: left;
  transition: transform 0.15s ease;
  margin-bottom: 10px;
}

.cat-btn { box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
.cat-btn:active { transform: scale(0.98); }

.cat-btn--problems { background: var(--red-light); }
.cat-btn--wishes { background: var(--yellow-light); }
.cat-btn--positive { background: var(--ampel-green-light); }

.cat-btn__icon {
  width: 48px;
  height: 48px;
  border-radius: var(--radius-md);
  background: var(--white);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  flex-shrink: 0;
}

.cat-btn__label {
  font-weight: 700;
  font-size: 16px;
}

.cat-btn--problems .cat-btn__label { color: var(--red); }
.cat-btn--wishes .cat-btn__label { color: var(--yellow); }
.cat-btn--positive .cat-btn__label { color: var(--ampel-green); }

.cat-btn__count {
  font-size: 12px;
  color: var(--gray-mid);
  margin-top: 2px;
}

.cat-btn__arrow {
  margin-left: auto;
  font-size: 18px;
}

.cat-btn--problems .cat-btn__arrow { color: var(--red); }
.cat-btn--wishes .cat-btn__arrow { color: var(--yellow); }
.cat-btn--positive .cat-btn__arrow { color: var(--ampel-green); }

/* â”€â”€â”€ Category Cards (Subcategory Screen) â”€â”€â”€ */
.screen-header {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 16px 20px;
  background: var(--white);
  border-bottom: 2px solid var(--gray-light);
  flex-shrink: 0;
}

.screen-header__back {
  background: none;
  font-size: 22px;
  color: var(--gray);
  padding: 4px;
}

.screen-header__title {
  font-size: 17px;
  font-weight: 700;
}

.screen-header__subtitle {
  font-size: 12px;
  color: var(--gray-mid);
}

.screen-body {
  flex: 1;
  overflow-y: auto;
  padding: 12px 16px;
  -webkit-overflow-scrolling: touch;
}

.category-card {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 14px 16px;
  border: 1px solid #E8EBED;
  border-left: 5px solid var(--accent, var(--blue));
  border-radius: var(--radius-md);
  background: var(--white);
  width: 100%;
  text-align: left;
  box-shadow: var(--shadow-sm);
  margin-bottom: 8px;
  transition: all 0.2s ease;
}

.category-card:active {
  border-color: var(--accent, var(--blue));
  background: color-mix(in srgb, var(--accent, var(--blue)) 5%, white);
}

.category-card__icon {
  width: 44px;
  height: 44px;
  border-radius: 12px;
  background: var(--accent-bg, var(--gray-light));
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 22px;
  flex-shrink: 0;
}

.category-card__label {
  font-weight: 600;
  font-size: 15px;
  color: #2D3339;
}

.category-card__desc {
  font-size: 12px;
  color: var(--gray-mid);
  margin-top: 2px;
}

.category-card__arrow {
  margin-left: auto;
  font-size: 18px;
  color: var(--gray-mid);
}

/* â”€â”€â”€ Details Screen â”€â”€â”€ */
.detail-section {
  margin-bottom: 20px;
}

.detail-label {
  font-size: 13px;
  font-weight: 600;
  margin-bottom: 8px;
}

.detail-map {
  height: 200px;
  border-radius: var(--radius-md);
  overflow: hidden;
  border: 1px solid var(--gray-light);
}

.detail-map-hint {
  font-size: 11px;
  color: var(--gray-mid);
  margin-top: 6px;
}

/* â”€â”€â”€ Photos â”€â”€â”€ */
.photo-grid {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.photo-thumb {
  width: 72px;
  height: 72px;
  border-radius: 12px;
  overflow: hidden;
  position: relative;
}

.photo-thumb img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.photo-thumb__remove {
  position: absolute;
  top: -4px;
  right: -4px;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: var(--red);
  color: var(--white);
  font-size: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 2px solid var(--white);
}

.photo-add {
  width: 72px;
  height: 72px;
  border-radius: 12px;
  border: 2px dashed var(--gray-mid);
  background: transparent;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 2px;
  color: var(--gray-mid);
  font-size: 24px;
  transition: all 0.2s;
}

.photo-add small {
  font-size: 9px;
  font-weight: 500;
}

.photo-add:active {
  border-color: var(--blue);
  color: var(--blue);
}

/* â”€â”€â”€ Comment â”€â”€â”€ */
.comment-input {
  width: 100%;
  padding: 12px 14px;
  border-radius: 12px;
  border: 1.5px solid var(--gray-light);
  font-size: 14px;
  color: var(--gray);
  resize: vertical;
  outline: none;
  transition: border-color 0.2s;
  min-height: 80px;
}

.comment-input:focus {
  border-color: var(--blue);
}

.comment-input::placeholder {
  color: var(--gray-mid);
}

/* â”€â”€â”€ Primary Button â”€â”€â”€ */
.btn-primary {
  width: 100%;
  padding: 16px;
  border-radius: var(--radius-md);
  background: linear-gradient(135deg, var(--blue), var(--green));
  color: var(--white);
  font-size: 16px;
  font-weight: 700;
  box-shadow: 0 4px 16px rgba(26,95,168,0.3);
  transition: transform 0.15s ease, box-shadow 0.15s ease;
}

.btn-primary:active {
  transform: scale(0.98);
  box-shadow: 0 2px 8px rgba(26,95,168,0.2);
}

.btn-secondary {
  width: 100%;
  padding: 14px;
  border-radius: var(--radius-md);
  border: 2px solid var(--blue);
  background: transparent;
  color: var(--blue);
  font-size: 15px;
  font-weight: 600;
}

/* â”€â”€â”€ GPS Status â”€â”€â”€ */
.gps-status {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 12px;
  color: var(--gray-mid);
  padding: 8px 14px;
  background: var(--white);
  border-radius: 12px;
  box-shadow: var(--shadow-md);
}

.gps-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  animation: pulse 2s ease-in-out infinite;
}

.gps-status--good .gps-dot { background: var(--ampel-green); }
.gps-status--ok .gps-dot { background: var(--yellow); }
.gps-status--poor .gps-dot { background: var(--red); }
.gps-dot--error { background: var(--red); animation: none; }

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.4; }
}

/* â”€â”€â”€ Confirm Screen â”€â”€â”€ */
.confirm-screen {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  padding: 32px;
  background: linear-gradient(180deg, #fff 0%, #F0F7FF 100%);
  height: 100%;
}

.confirm-icon {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--ampel-green), var(--blue));
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 36px;
  color: var(--white);
  margin-bottom: 20px;
  box-shadow: 0 8px 32px rgba(0,168,54,0.3);
  animation: scaleIn 0.4s ease-out;
}

@keyframes scaleIn {
  0% { transform: scale(0); }
  70% { transform: scale(1.1); }
  100% { transform: scale(1); }
}

.confirm-title {
  font-size: 22px;
  font-weight: 700;
  margin-bottom: 8px;
}

.confirm-text {
  font-size: 14px;
  color: var(--gray-mid);
  line-height: 1.5;
  margin-bottom: 32px;
}

/* â”€â”€â”€ Report List â”€â”€â”€ */
.report-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 14px 16px;
  border-radius: var(--radius-md);
  background: var(--white);
  box-shadow: var(--shadow-sm);
  margin-bottom: 8px;
}

.report-item__icon {
  width: 42px;
  height: 42px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  flex-shrink: 0;
}

.report-item__label {
  font-weight: 600;
  font-size: 14px;
}

.report-item__meta {
  font-size: 11px;
  color: var(--gray-mid);
  margin-top: 2px;
}

.report-item__comment {
  font-size: 12px;
  color: var(--gray);
  opacity: 0.7;
  margin-top: 4px;
}

.report-item__delete {
  background: none;
  font-size: 16px;
  padding: 4px;
  opacity: 0.4;
  flex-shrink: 0;
}

.report-item__delete:active { opacity: 1; }

/* â”€â”€â”€ Empty State â”€â”€â”€ */
.empty-state {
  text-align: center;
  padding: 48px 20px;
}

.empty-state__icon {
  font-size: 48px;
  margin-bottom: 12px;
}

.empty-state p {
  color: var(--gray-mid);
  font-size: 14px;
  line-height: 1.5;
}

/* â”€â”€â”€ Report Badge â”€â”€â”€ */
.report-badge {
  position: absolute;
  top: 16px;
  right: 16px;
  z-index: 1000;
}

.report-badge__btn {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 16px;
  background: var(--white);
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-md);
  font-size: 13px;
  font-weight: 600;
  color: var(--gray);
}

/* â”€â”€â”€ Export Buttons â”€â”€â”€ */
.export-btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 8px 14px;
  background: var(--blue-light);
  border-radius: var(--radius-sm);
  font-size: 12px;
  font-weight: 600;
  color: var(--blue);
}

.export-btn:active {
  background: var(--blue);
  color: var(--white);
}

/* â”€â”€â”€ Toast â”€â”€â”€ */
.toast {
  position: fixed;
  bottom: 24px;
  left: 50%;
  transform: translateX(-50%) translateY(80px);
  background: var(--gray);
  color: var(--white);
  padding: 10px 20px;
  border-radius: 12px;
  font-size: 13px;
  font-weight: 500;
  box-shadow: 0 4px 16px rgba(0,0,0,0.2);
  z-index: 100;
  transition: transform 0.3s ease, opacity 0.3s ease;
  opacity: 0;
  pointer-events: none;
}

.toast--visible {
  transform: translateX(-50%) translateY(0);
  opacity: 1;
}

/* â”€â”€â”€ Leaflet Overrides â”€â”€â”€ */

/* â”€â”€â”€ Sync Status â”€â”€â”€ */

/* â”€â”€â”€ Settings â”€â”€â”€ */
.setting-option {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  padding: 14px 16px;
  border: 1.5px solid #E8EBED;
  border-radius: 12px;
  background: var(--white);
  margin-bottom: 8px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.setting-option:has(input:checked) {
  border-color: var(--blue);
  background: #F0F7FF;
}

.setting-option input[type="radio"] {
  margin-top: 3px;
  accent-color: var(--blue);
  width: 18px;
  height: 18px;
  flex-shrink: 0;
}

.setting-option__label {
  font-weight: 600;
  font-size: 14px;
  color: #2D3339;
}

.setting-option__desc {
  font-size: 12px;
  color: var(--gray-mid);
  margin-top: 2px;
}

.sync-status {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 11px;
  color: var(--gray-mid);
  padding: 6px 12px;
  background: var(--white);
  border-radius: 10px;
  box-shadow: var(--shadow-sm);
}

.sync-dot {
  width: 7px;
  height: 7px;
  border-radius: 50%;
}

.sync-status--synced .sync-dot { background: var(--ampel-green); }
.sync-status--pending .sync-dot { background: var(--yellow); animation: pulse 1.5s ease-in-out infinite; }
.sync-status--offline .sync-dot { background: var(--gray-mid); }
.sync-status--error .sync-dot { background: var(--red); }

.leaflet-control-zoom a {
  border-radius: 10px !important;
}

.leaflet-popup-content-wrapper {
  border-radius: 12px !important;
  box-shadow: var(--shadow-md) !important;
}

  </style>
</head>
<body>


<div class="app">

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- SCREEN: Home (Karte + Kategorien)          -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div data-screen="home" class="screen--active">
    
    <!-- Header mit Logo -->
    <div style="display:flex; flex-direction:column; align-items:center; justify-content:center; padding:16px 20px 12px; background:#fff; border-bottom:none; z-index:20; flex-shrink:0; box-shadow:0 2px 8px rgba(0,0,0,0.06);">
      <div style="font-weight:800; font-size:26px; letter-spacing:4px; text-transform:uppercase;">
        <span style="color:#1A5FA8;">Radwege</span><span style="color:#2D8C28;">melder</span>
      </div>
      <div style="font-size:11px; color:#8A9BA4; font-weight:500; margin-top:3px; letter-spacing:0.3px;">by 2Rat Â· PlanungsbÃ¼ro fÃ¼r Radverkehr</div>
    </div>
    <!-- Karte -->
    <div class="map-container">
      <div id="map-container"></div>

      <!-- GPS-Status (Overlay auf Karte) -->
      <!-- Status-Leiste Ã¼ber der Karte -->
      <div style="position:absolute; top:8px; left:8px; right:8px; z-index:1000; display:flex; align-items:center; gap:6px;">
        <div id="gps-status" class="gps-status">
          <span class="gps-dot"></span> GPS wird gesuchtâ€¦
        </div>
        <div id="sync-status" class="sync-status sync-status--offline">
          <span class="sync-dot"></span> <span id="sync-text">Offline</span>
        </div>
        <div style="margin-left:auto;">
          <button id="btn-my-reports" class="report-badge__btn">
            ğŸ“‹ <span id="report-badge" style="display:none;">0</span> Meldungen ansehen
          </button>
        </div>
      </div>
    </div>

    <!-- Unterer Bereich: Kategorien -->
    <div class="home-bottom">
      <h2 class="home-bottom__title">Was mÃ¶chtest du melden?</h2>
      <p class="home-bottom__subtitle">WÃ¤hle eine Kategorie fÃ¼r deine Meldung.</p>

      <!-- Problem -->
      <button class="cat-btn cat-btn--problems" data-category="problems">
        <div class="cat-btn__icon">âš ï¸</div>
        <div>
          <div class="cat-btn__label">Problem melden</div>
          <div class="cat-btn__count">11 Unterkategorien</div>
        </div>
        <div class="cat-btn__arrow">â€º</div>
      </button>

      <!-- Wunsch -->
      <button class="cat-btn cat-btn--wishes" data-category="wishes">
        <div class="cat-btn__icon">ğŸ’¬</div>
        <div>
          <div class="cat-btn__label">Wunsch Ã¤uÃŸern</div>
          <div class="cat-btn__count">6 Unterkategorien</div>
        </div>
        <div class="cat-btn__arrow">â€º</div>
      </button>

      <!-- Positiv -->
      <button class="cat-btn cat-btn--positive" data-category="positive">
        <div class="cat-btn__icon">ğŸ‘</div>
        <div>
          <div class="cat-btn__label">Lob aussprechen</div>
          <div class="cat-btn__count">3 Unterkategorien</div>
        </div>
        <div class="cat-btn__arrow">â€º</div>
      </button>

      <!-- Footer -->
      <div style="text-align:center; margin-top:16px; padding-top:12px; border-top:1px solid #F0F2F4; font-size:11px; color:#8A9BA4;">
        <a href="./datenschutz.html" style="color:#8A9BA4; text-decoration:none;">ğŸ”’ Datenschutz</a>
        &nbsp;Â·&nbsp;
        <a href="#settings" style="color:#8A9BA4; text-decoration:none;">âš™ï¸ Einstellungen</a>
        &nbsp;Â·&nbsp;
        <span>v1.1</span>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- SCREEN: Unterkategorie wÃ¤hlen              -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div data-screen="subcategory">
    <div class="screen-header">
      <button class="screen-header__back" data-back>â†</button>
      <div>
        <h3 class="screen-header__title" id="subcategory-title"></h3>
        <p class="screen-header__subtitle">Was genau mÃ¶chtest du melden?</p>
      </div>
    </div>
    <div class="screen-body" id="subcategory-list">
      <!-- Wird dynamisch gefÃ¼llt -->
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- SCREEN: Details (Standort, Foto, Kommentar)-->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div data-screen="details">
    <div class="screen-header">
      <button class="screen-header__back" data-back>â†</button>
      <div>
        <h3 class="screen-header__title" id="detail-title"></h3>
        <p class="screen-header__subtitle" id="detail-description"></p>
      </div>
    </div>
    <div class="screen-body">

      <!-- Standort -->
      <div class="detail-section">
        <div class="detail-label">ğŸ“ Standort</div>
        <div class="detail-map" id="detail-map"></div>
        <div style="display:flex; align-items:center; justify-content:space-between; margin-top:8px;">
          <p class="detail-map-hint" id="detail-gps-info">Dein aktueller GPS-Standort wird verwendet</p>
          <button onclick="centerOnPosition()" style="background:none; border:1px solid #1A5FA8; color:#1A5FA8; border-radius:8px; padding:4px 10px; font-size:11px; font-weight:600; cursor:pointer;">ğŸ“ Zentrieren</button>
        </div>
      </div>

      <!-- Foto -->
      <div class="detail-section">
        <div class="detail-label">ğŸ“· Foto (optional)</div>
        <div class="photo-grid" id="photo-preview">
          <button id="btn-add-photo" class="photo-add">
            <span>+</span>
            <small>Foto</small>
          </button>
        </div>
      </div>

      <!-- Kommentar -->
      <div class="detail-section">
        <div class="detail-label">ğŸ’¬ Kommentar (optional)</div>
        <textarea
          id="comment-input"
          class="comment-input"
          placeholder="Beschreibe das Problem genauerâ€¦"
          rows="3"
        ></textarea>
      </div>

      <!-- Speichern -->
      <div style="padding:8px 0 16px;">
        <button id="btn-save-report" class="btn-primary">
          âœ“ Meldung speichern
        </button>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- SCREEN: BestÃ¤tigung                        -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div data-screen="confirm">
    <div class="confirm-screen">
      <div class="confirm-icon">âœ“</div>
      <h2 class="confirm-title">Danke fÃ¼r deine Meldung!</h2>
      <p class="confirm-text">
        Deine Meldung wurde gespeichert.<br>
        <span id="confirm-sync-info">Wird automatisch synchronisiert, sobald eine Verbindung besteht.</span>
      </p>
      <button id="btn-new-report" class="btn-primary" style="margin-bottom:12px;">
        + Weitere Meldung erstellen
      </button>
      <button class="btn-secondary" onclick="window.location.hash='list'" style="margin-bottom:8px;">
        ğŸ“‹ Meine Meldungen ansehen
      </button>
      <button class="btn-secondary" onclick="window.location.hash='home'" style="border-color:#8A9BA4; color:#8A9BA4;">
        ğŸ—ºï¸ ZurÃ¼ck zur Karte
      </button>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- SCREEN: Meine Meldungen                    -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div data-screen="list">
    <div class="screen-header">
      <button class="screen-header__back" data-back>â†</button>
      <h3 class="screen-header__title" style="flex:1;">Meine Meldungen</h3>
      <div style="display:flex; gap:6px;">
        <button id="btn-export-geojson" class="export-btn">ğŸ“¥ GeoJSON</button>
        <button id="btn-export-csv" class="export-btn">ğŸ“¥ CSV</button>
        <button id="btn-export-qgis" class="export-btn" style="background:#E0F2DE; color:#2D8C28;">ğŸ¨ QGIS</button>
      </div>
    </div>
    <div class="screen-body" id="report-list">
      <!-- Wird dynamisch gefÃ¼llt -->
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- SCREEN: Einstellungen                       -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div data-screen="settings">
    <div class="screen-header">
      <button class="screen-header__back" data-back>â†</button>
      <h3 class="screen-header__title">Einstellungen</h3>
    </div>
    <div class="screen-body">

      <!-- Sync-Modus -->
      <div class="detail-section">
        <div class="detail-label">ğŸ“¡ DatenÃ¼bertragung</div>
        <p style="font-size:12px; color:#8A9BA4; margin-bottom:12px;">Wann sollen deine Meldungen an den Server Ã¼bertragen werden?</p>

        <label class="setting-option" id="opt-sync-auto">
          <input type="radio" name="syncMode" value="auto">
          <div class="setting-option__text">
            <div class="setting-option__label">ğŸ”„ Automatisch</div>
            <div class="setting-option__desc">Sofort Ã¼bertragen (Mobile Daten + WLAN)</div>
          </div>
        </label>

        <label class="setting-option" id="opt-sync-wifi">
          <input type="radio" name="syncMode" value="wifi" checked>
          <div class="setting-option__text">
            <div class="setting-option__label">ğŸ“¶ Nur WLAN</div>
            <div class="setting-option__desc">Ãœbertragung nur im WLAN â€“ spart Datenvolumen</div>
          </div>
        </label>

        <label class="setting-option" id="opt-sync-manual">
          <input type="radio" name="syncMode" value="manual">
          <div class="setting-option__text">
            <div class="setting-option__label">ğŸ‘† Manuell</div>
            <div class="setting-option__desc">Du entscheidest selbst, wann synchronisiert wird</div>
          </div>
        </label>
      </div>

      <!-- Manueller Sync-Button -->
      <div class="detail-section" id="manual-sync-section" style="display:none;">
        <button id="btn-manual-sync" class="btn-primary" style="background:linear-gradient(135deg, #1A5FA8, #4A90D9);">
          ğŸ“¡ Jetzt synchronisieren
        </button>
        <p id="pending-count" style="font-size:12px; color:#8A9BA4; text-align:center; margin-top:8px;"></p>
      </div>

      <!-- Info -->
      <div class="detail-section" style="background:#F0F7FF; border-radius:12px; padding:14px;">
        <p style="font-size:12px; color:#5A6A72; line-height:1.5;">
          <strong>â„¹ï¸ Hinweis:</strong> Meldungen werden immer zuerst lokal auf deinem GerÃ¤t gespeichert. 
          Die Ãœbertragung an den Server ist optional â€“ du kannst deine Daten auch jederzeit als GeoJSON oder CSV exportieren.
        </p>
      </div>

    </div>
  </div>

</div>

<!-- App JS (als Module) -->



<script>
// â•â•â• categories.js â•â•â•
// â”€â”€â”€ 2Rat Radmelder â€“ Kategorien-System â”€â”€â”€

const CATEGORIES = {
  // â”€â”€â”€ ROT: Probleme / MÃ¤ngel â”€â”€â”€
  problems: {
    id: 'problems',
    label: 'Problem melden',
    emoji: 'âš ï¸',
    color: '#E00000',
    bgColor: '#FF9999',
    items: [
      {
        id: 'surface',
        icon: 'ğŸ•³ï¸',
        label: 'OberflÃ¤che',
        description: 'SchlaglÃ¶cher, WurzelaufbrÃ¼che, Rillen, Kopfsteinpflaster',
        tags: ['schlagloch', 'wurzel', 'rille', 'pflaster', 'belag'],
      },
      {
        id: 'narrow',
        icon: 'â†”ï¸',
        label: 'Engstelle',
        description: 'Zu schmaler Radweg, Hindernisse, Poller',
        tags: ['eng', 'schmal', 'hindernis', 'poller', 'breite'],
      },
      {
        id: 'crossing',
        icon: 'ğŸ”€',
        label: 'Kreuzung / Knoten',
        description: 'GefÃ¤hrliche FÃ¼hrung, schlechte Sicht, fehlende Signalisierung',
        tags: ['kreuzung', 'knoten', 'sicht', 'signal', 'ampel'],
      },
      {
        id: 'traverse',
        icon: 'ğŸš¶',
        label: 'Querung',
        description: 'Fehlende Querungshilfe, Umwege, Barrieren',
        tags: ['querung', 'umweg', 'barriere', 'Ã¼berweg'],
      },
      {
        id: 'conflict',
        icon: 'ğŸ’¥',
        label: 'Konflikte',
        description: 'Dooring-Gefahr, FuÃŸgÃ¤ngerkonflikte, Kfz-Konflikte',
        tags: ['dooring', 'fussgÃ¤nger', 'auto', 'konflikt', 'gefahr'],
      },
      {
        id: 'parking',
        icon: 'ğŸ…¿ï¸',
        label: 'Parken',
        description: 'Zugeparkte Radwege, Falschparker, fehlende Kontrolle',
        tags: ['parken', 'zugeparkt', 'falschparker', 'zweite-reihe'],
      },
      {
        id: 'signage',
        icon: 'ğŸª§',
        label: 'Wegweisung',
        description: 'Fehlend, beschÃ¤digt, verwirrend',
        tags: ['schild', 'wegweisung', 'beschilderung', 'markierung'],
      },
      {
        id: 'lighting',
        icon: 'ğŸ’¡',
        label: 'Beleuchtung',
        description: 'Fehlend, defekt, unzureichend',
        tags: ['licht', 'dunkel', 'laterne', 'beleuchtung'],
      },
      {
        id: 'winter',
        icon: 'â„ï¸',
        label: 'Winterdienst / Reinigung',
        description: 'Nicht gerÃ¤umt, Laub, Scherben, Verschmutzung',
        tags: ['winter', 'schnee', 'eis', 'laub', 'glas', 'dreck'],
      },
      {
        id: 'barrier_free',
        icon: 'â™¿',
        label: 'Barrierefreiheit',
        description: 'Hohe Bordsteine, fehlende Absenkung, Umlaufsperren',
        tags: ['bordstein', 'absenkung', 'rampe', 'umlaufsperre', 'barriere'],
      },
      {
        id: 'other_problem',
        icon: 'â“',
        label: 'Sonstiges',
        description: 'Anderes Problem (Freitext)',
        tags: ['sonstiges'],
      },
    ],
  },

  // â”€â”€â”€ GELB: WÃ¼nsche â”€â”€â”€
  wishes: {
    id: 'wishes',
    label: 'Wunsch Ã¤uÃŸern',
    emoji: 'ğŸ’¬',
    color: '#E5A700',
    bgColor: '#FFD966',
    items: [
      {
        id: 'new_path',
        icon: 'ğŸ›¤ï¸',
        label: 'Radweg gewÃ¼nscht',
        description: 'Neue Verbindung, LÃ¼ckenschluss',
        tags: ['radweg', 'verbindung', 'lÃ¼cke', 'neu'],
      },
      {
        id: 'bike_parking',
        icon: 'ğŸ”’',
        label: 'Abstellanlage',
        description: 'FahrradbÃ¼gel, Ã¼berdacht, Ladestation',
        tags: ['abstellen', 'bÃ¼gel', 'parkplatz', 'laden'],
      },
      {
        id: 'tempo30',
        icon: 'ğŸŒ',
        label: 'Tempo 30',
        description: 'Geschwindigkeitsreduzierung gewÃ¼nscht',
        tags: ['tempo', 'geschwindigkeit', '30', 'zone'],
      },
      {
        id: 'traffic_light',
        icon: 'ğŸš¦',
        label: 'Ampelschaltung',
        description: 'GrÃ¼ne Welle, kÃ¼rzere Wartezeit, Anforderungstaster',
        tags: ['ampel', 'grÃ¼n', 'welle', 'wartezeit', 'taster'],
      },
      {
        id: 'bike_street',
        icon: 'ğŸš²',
        label: 'FahrradstraÃŸe',
        description: 'Umwidmung gewÃ¼nscht',
        tags: ['fahrradstrasse', 'fahrradzone', 'umwidmung'],
      },
      {
        id: 'oneway',
        icon: 'â†©ï¸',
        label: 'EinbahnstraÃŸe Ã¶ffnen',
        description: 'Freigabe fÃ¼r Radverkehr in Gegenrichtung',
        tags: ['einbahnstrasse', 'gegenrichtung', 'freigabe', 'Ã¶ffnen'],
      },
    ],
  },

  // â”€â”€â”€ GRÃœN: Positiv â”€â”€â”€
  positive: {
    id: 'positive',
    label: 'Lob aussprechen',
    emoji: 'ğŸ‘',
    color: '#00A836',
    bgColor: '#8FD99F',
    items: [
      {
        id: 'good_infra',
        icon: 'â­',
        label: 'Gute Infrastruktur',
        description: 'Vorbildlicher Radweg, gute LÃ¶sung',
        tags: ['gut', 'vorbild', 'radweg', 'lÃ¶sung'],
      },
      {
        id: 'safe_crossing',
        icon: 'âœ…',
        label: 'Sichere Querung',
        description: 'Gut gestaltete Kreuzung oder Ãœberweg',
        tags: ['sicher', 'kreuzung', 'querung', 'Ã¼berweg'],
      },
      {
        id: 'service',
        icon: 'ğŸ› ï¸',
        label: 'Service',
        description: 'Reparaturstation, Luftpumpe, Trinkwasser',
        tags: ['reparatur', 'pumpe', 'service', 'wasser'],
      },
    ],
  },
};

/**
 * Kategorie nach ID finden
 */
function getCategoryById(categoryId) {
  return CATEGORIES[categoryId] || null;
}

/**
 * Unterkategorie nach IDs finden
 */
function getSubcategoryById(categoryId, subcategoryId) {
  const cat = CATEGORIES[categoryId];
  if (!cat) return null;
  return cat.items.find((item) => item.id === subcategoryId) || null;
}

/**
 * Alle Kategorien als flache Liste (fÃ¼r Export)
 */
function getAllSubcategories() {
  const result = [];
  for (const [catId, cat] of Object.entries(CATEGORIES)) {
    for (const item of cat.items) {
      result.push({
        categoryId: catId,
        categoryLabel: cat.label,
        ...item,
      });
    }
  }
  return result;
}



// â•â•â• db.js â•â•â•
// â”€â”€â”€ 2Rat Radmelder â€“ Datenbank (IndexedDB via Dexie.js) â”€â”€â”€
// Dexie wird per CDN in index.html geladen

const DB_NAME = 'radmelder';
const DB_VERSION = 1;

let db;

/**
 * Datenbank initialisieren
 */
function initDB() {
  db = new Dexie(DB_NAME);

  db.version(DB_VERSION).stores({
    // Haupttabelle fÃ¼r Meldungen
    reports: '++localId, id, category, subcategory, timestamp, syncStatus',
    // Fotos separat (wegen GrÃ¶ÃŸe)
    photos: '++id, reportLocalId, data, timestamp',
    // Einstellungen
    settings: 'key',
  });

  console.log('[DB] Initialisiert');
  return db;
}

// â”€â”€â”€ REPORTS â”€â”€â”€

/**
 * Neue Meldung speichern
 * @param {Object} report - Meldungsdaten
 * @returns {number} localId
 */
async function saveReport(report) {
  const entry = {
    id: crypto.randomUUID(),
    latitude: report.latitude,
    longitude: report.longitude,
    accuracy: report.accuracy || null,
    heading: report.heading || null,
    timestamp: new Date().toISOString(),
    category: report.category,
    subcategory: report.subcategory,
    comment: report.comment || '',
    photoCount: report.photoCount || 0,
    syncStatus: 'local', // local | queued | synced
    serverId: null,
  };

  const localId = await db.reports.add(entry);
  console.log(`[DB] Meldung gespeichert: ${localId}`);
  return localId;
}

/**
 * Alle Meldungen laden
 * @returns {Array} Meldungen sortiert nach Zeitstempel (neueste zuerst)
 */
async function getAllReports() {
  return db.reports.orderBy('timestamp').reverse().toArray();
}

/**
 * Einzelne Meldung laden
 * @param {number} localId
 * @returns {Object} Meldung
 */
async function getReport(localId) {
  return db.reports.get(localId);
}

/**
 * Meldung lÃ¶schen
 * @param {number} localId
 */
async function deleteReport(localId) {
  await db.photos.where('reportLocalId').equals(localId).delete();
  await db.reports.delete(localId);
  console.log(`[DB] Meldung gelÃ¶scht: ${localId}`);
}

/**
 * Anzahl der Meldungen
 * @returns {number}
 */
async function getReportCount() {
  return db.reports.count();
}

// â”€â”€â”€ FOTOS â”€â”€â”€

/**
 * Foto zu Meldung hinzufÃ¼gen
 * @param {number} reportLocalId
 * @param {string} dataUrl - Base64-kodiertes Foto
 */
async function savePhoto(reportLocalId, dataUrl) {
  await db.photos.add({
    reportLocalId,
    data: dataUrl,
    timestamp: new Date().toISOString(),
  });
}

/**
 * Alle Fotos einer Meldung laden
 * @param {number} reportLocalId
 * @returns {Array}
 */
async function getPhotosForReport(reportLocalId) {
  return db.photos.where('reportLocalId').equals(reportLocalId).toArray();
}

// â”€â”€â”€ EINSTELLUNGEN â”€â”€â”€

/**
 * Einstellung speichern
 */
async function setSetting(key, value) {
  await db.settings.put({ key, value });
}

/**
 * Einstellung laden
 */
async function getSetting(key, defaultValue = null) {
  const entry = await db.settings.get(key);
  return entry ? entry.value : defaultValue;
}

// â”€â”€â”€ STATISTIKEN â”€â”€â”€

/**
 * Statistik-Ãœbersicht
 */
async function getStats() {
  const all = await db.reports.toArray();
  const stats = {
    total: all.length,
    problems: all.filter((r) => r.category === 'problems').length,
    wishes: all.filter((r) => r.category === 'wishes').length,
    positive: all.filter((r) => r.category === 'positive').length,
    synced: all.filter((r) => r.syncStatus === 'synced').length,
    local: all.filter((r) => r.syncStatus === 'local').length,
  };
  return stats;
}




// â•â•â• router.js â•â•â•
// â”€â”€â”€ 2Rat Radmelder â€“ Router (Screen-Navigation) â”€â”€â”€

/**
 * Einfacher Hash-basierter Router fÃ¼r Single-Page-Navigation.
 * Screens werden per CSS-Klasse ein-/ausgeblendet.
 *
 * Verwendung:
 *   initRouter({
 *     default: 'home',
 *     routes: {
 *       'home':        () => showHomeScreen(),
 *       'category':    (params) => showCategoryScreen(params),
 *       'details':     (params) => showDetailsScreen(params),
 *       'confirm':     () => showConfirmScreen(),
 *       'list':        () => showListScreen(),
 *     }
 *   });
 *
 *   navigate('category', { type: 'problems' });
 *   goBack();
 */

let routerConfig = null;
let history = [];

/**
 * Router initialisieren
 */
function initRouter(config) {
  routerConfig = config;
  history = [];

  // Hash-Ã„nderungen abfangen
  window.addEventListener('hashchange', () => {
    const screen = getScreenFromHash();
    activateScreen(screen);
  });

  // Initiales Routing
  const initial = getScreenFromHash() || config.default || 'home';
  navigate(initial);
}

/**
 * Screen-Name aus Hash extrahieren
 */
function getScreenFromHash() {
  const hash = window.location.hash.replace('#', '');
  return hash || null;
}

/**
 * Zu Screen navigieren
 * @param {string} screenId - Name des Screens
 * @param {Object} params - Optionale Parameter
 */
function navigate(screenId, params = {}) {
  // In History pushen
  history.push({ screen: screenId, params });

  // Hash aktualisieren (ohne hashchange auszulÃ¶sen)
  window.location.hash = screenId;

  // Screen aktivieren
  activateScreen(screenId, params);
}

/**
 * ZurÃ¼ck navigieren
 */
function goBack() {
  if (history.length > 1) {
    history.pop(); // Aktuellen entfernen
    const prev = history[history.length - 1];
    window.location.hash = prev.screen;
    activateScreen(prev.screen, prev.params);
  } else {
    navigate(routerConfig.default || 'home');
  }
}

/**
 * Screen aktivieren (CSS-Klasse + Callback)
 */
function activateScreen(screenId, params = {}) {
  // Alle Screens ausblenden
  document.querySelectorAll('[data-screen]').forEach((el) => {
    el.classList.remove('screen--active');
    el.setAttribute('aria-hidden', 'true');
  });

  // Ziel-Screen einblenden
  const target = document.querySelector(`[data-screen="${screenId}"]`);
  if (target) {
    target.classList.add('screen--active');
    target.setAttribute('aria-hidden', 'false');
    target.scrollTop = 0; // Scroll zurÃ¼cksetzen
  }

  // Route-Callback ausfÃ¼hren
  if (routerConfig?.routes?.[screenId]) {
    routerConfig.routes[screenId](params);
  }
}

/**
 * Aktuellen Screen abfragen
 */
function getCurrentScreen() {
  return history.length > 0 ? history[history.length - 1] : null;
}

/**
 * Hardware-ZurÃ¼ck-Button abfangen (Android)
 */
function enableBackButton() {
  window.addEventListener('popstate', (e) => {
    if (history.length > 1) {
      e.preventDefault();
      goBack();
    }
  });
}



// â•â•â• camera.js â•â•â•
// â”€â”€â”€ 2Rat Radmelder â€“ Kamera-Modul â”€â”€â”€

/**
 * Foto aufnehmen via HTML5 Input (zuverlÃ¤ssigste Methode auf Mobile)
 * Gibt ein Promise zurÃ¼ck mit Base64-Daten und Thumbnail
 *
 * @param {Object} options
 * @param {number} options.maxWidth - Max Breite in Pixel (default: 1280)
 * @param {number} options.quality - JPEG-QualitÃ¤t 0-1 (default: 0.8)
 * @returns {Promise<{dataUrl: string, thumbnail: string, width: number, height: number}>}
 */
function capturePhoto(options = {}) {
  const maxWidth = options.maxWidth || 1280;
  const quality = options.quality || 0.8;

  return new Promise((resolve, reject) => {
    // Verstecktes File-Input erstellen
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = 'image/*';
    input.capture = 'environment'; // RÃ¼ckkamera bevorzugen

    input.addEventListener('change', (event) => {
      const file = event.target.files[0];
      if (!file) {
        reject(new Error('Keine Datei ausgewÃ¤hlt'));
        return;
      }

      processImage(file, maxWidth, quality)
        .then(resolve)
        .catch(reject);
    });

    input.addEventListener('cancel', () => {
      reject(new Error('Abgebrochen'));
    });

    // Dialog Ã¶ffnen
    input.click();
  });
}

/**
 * Bild verarbeiten: Resize + Komprimierung
 */
function processImage(file, maxWidth, quality) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();

    reader.onload = (e) => {
      const img = new Image();
      img.onload = () => {
        // Resize wenn nÃ¶tig
        let width = img.width;
        let height = img.height;

        if (width > maxWidth) {
          height = Math.round(height * (maxWidth / width));
          width = maxWidth;
        }

        // Canvas fÃ¼r Komprimierung
        const canvas = document.createElement('canvas');
        canvas.width = width;
        canvas.height = height;

        const ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0, width, height);

        const dataUrl = canvas.toDataURL('image/jpeg', quality);

        // Thumbnail erstellen (200px breit)
        const thumbWidth = 200;
        const thumbHeight = Math.round(height * (thumbWidth / width));
        canvas.width = thumbWidth;
        canvas.height = thumbHeight;
        ctx.drawImage(img, 0, 0, thumbWidth, thumbHeight);
        const thumbnail = canvas.toDataURL('image/jpeg', 0.6);

        resolve({
          dataUrl,
          thumbnail,
          width,
          height,
          originalName: file.name,
          size: dataUrl.length,
        });
      };

      img.onerror = () => reject(new Error('Bild konnte nicht geladen werden'));
      img.src = e.target.result;
    };

    reader.onerror = () => reject(new Error('Datei konnte nicht gelesen werden'));
    reader.readAsDataURL(file);
  });
}

/**
 * PrÃ¼fen ob Kamera verfÃ¼gbar ist
 */
function isCameraAvailable() {
  return 'mediaDevices' in navigator && 'getUserMedia' in navigator.mediaDevices;
}



// â•â•â• map.js â•â•â•
// â”€â”€â”€ 2Rat Radmelder â€“ Kartenmodul (Leaflet + GPS) â”€â”€â”€

let map = null;
let userMarker = null;
let reportMarkers = [];
let currentPosition = null;
let watchId = null;

// Marker-Farben passend zu Kategorien (Ampel)
const MARKER_COLORS = {
  problems: '#E00000',
  wishes: '#E5A700',
  positive: '#00A836',
};

/**
 * Karte initialisieren
 * @param {string} containerId - ID des HTML-Containers
 * @param {Object} options - Optionen
 */
function initMap(containerId, options = {}) {
  const defaultCenter = [49.41, 6.78]; // Lebach, Saarland (2Rat Standort)
  const defaultZoom = 14;

  map = L.map(containerId, {
    center: options.center || defaultCenter,
    zoom: options.zoom || defaultZoom,
    zoomControl: false, // Eigene Position stattdessen
    attributionControl: true,
  });

  // OpenStreetMap Tiles
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'Â© <a href="https://openstreetmap.org">OpenStreetMap</a>',
    maxZoom: 19,
  }).addTo(map);

  // Zoom-Control rechts unten
  L.control.zoom({ position: 'bottomright' }).addTo(map);

  // Karte nach kurzer VerzÃ¶gerung aktualisieren (Fix fÃ¼r Container-GrÃ¶ÃŸe)
  setTimeout(() => { map.invalidateSize(); }, 300);
  setTimeout(() => { map.invalidateSize(); }, 1000);

  console.log('[Map] Initialisiert');
  return map;
}

/**
 * GPS-Tracking starten
 * @param {Function} onUpdate - Callback bei Positionsupdate
 * @param {Function} onError - Callback bei Fehler
 */
function startGPS(onUpdate, onError) {
  if (!navigator.geolocation) {
    onError && onError('GPS nicht verfÃ¼gbar');
    return;
  }

  const gpsOptions = {
    enableHighAccuracy: true,
    timeout: 15000,
    maximumAge: 5000,
  };

  // Einmalige Position holen
  navigator.geolocation.getCurrentPosition(
    (pos) => {
      handlePosition(pos, onUpdate);
    },
    (err) => {
      console.warn('[GPS] Fehler:', err.message);
      onError && onError(err.message);
    },
    gpsOptions
  );

  // Kontinuierliches Tracking
  watchId = navigator.geolocation.watchPosition(
    (pos) => handlePosition(pos, onUpdate),
    (err) => console.warn('[GPS] Watch-Fehler:', err.message),
    gpsOptions
  );
}

/**
 * GPS-Tracking stoppen
 */
function stopGPS() {
  if (watchId !== null) {
    navigator.geolocation.clearWatch(watchId);
    watchId = null;
  }
}

/**
 * Position verarbeiten
 */
function handlePosition(pos, callback) {
  currentPosition = {
    latitude: pos.coords.latitude,
    longitude: pos.coords.longitude,
    accuracy: Math.round(pos.coords.accuracy),
    heading: pos.coords.heading,
    timestamp: pos.timestamp,
  };

  // User-Marker aktualisieren
  if (map) {
    const latlng = [currentPosition.latitude, currentPosition.longitude];

    if (userMarker) {
      userMarker.setLatLng(latlng);
    } else {
      userMarker = L.circleMarker(latlng, {
        radius: 8,
        fillColor: '#1A5FA8',
        fillOpacity: 1,
        color: '#FFFFFF',
        weight: 3,
      }).addTo(map);

      // Beim ersten Fix: Karte zentrieren
      map.setView(latlng, 16);
    }

    // Genauigkeitskreis
    if (userMarker._accuracyCircle) {
      userMarker._accuracyCircle.setLatLng(latlng);
      userMarker._accuracyCircle.setRadius(currentPosition.accuracy);
    } else {
      userMarker._accuracyCircle = L.circle(latlng, {
        radius: currentPosition.accuracy,
        fillColor: '#1A5FA8',
        fillOpacity: 0.1,
        color: '#1A5FA8',
        weight: 1,
        opacity: 0.3,
      }).addTo(map);
    }
  }

  callback && callback(currentPosition);
}

/**
 * Aktuelle GPS-Position holen
 * @returns {Object|null}
 */
function getCurrentPosition() {
  return currentPosition;
}

/**
 * Karte auf Position zentrieren
 */
function centerOnPosition() {
  if (map && currentPosition) {
    map.setView([currentPosition.latitude, currentPosition.longitude], 17);
  }
}

/**
 * Meldungs-Marker auf Karte setzen
 * @param {Array} reports - Array von Meldungen aus der DB
 */
function displayReports(reports) {
  // Alte Marker entfernen
  reportMarkers.forEach((m) => map.removeLayer(m));
  reportMarkers = [];

  reports.forEach((report) => {
    if (!report.latitude || !report.longitude) return;

    const color = MARKER_COLORS[report.category] || '#5A6A72';

    const marker = L.circleMarker([report.latitude, report.longitude], {
      radius: 10,
      fillColor: color,
      fillOpacity: 0.85,
      color: '#FFFFFF',
      weight: 2,
    }).addTo(map);

    // Popup mit Infos
    marker.bindPopup(`
      <div style="font-family: sans-serif; min-width: 150px;">
        <strong>${report.subcategory || report.category}</strong><br>
        <small style="color: #888;">${new Date(report.timestamp).toLocaleString('de-DE')}</small>
        ${report.comment ? `<p style="margin: 6px 0 0; font-size: 13px;">${report.comment}</p>` : ''}
      </div>
    `);

    reportMarkers.push(marker);
  });
}

/**
 * Karte auf alle Meldungen zoomen
 */
function fitToReports() {
  if (reportMarkers.length === 0) return;
  const group = L.featureGroup(reportMarkers);
  map.fitBounds(group.getBounds().pad(0.1));
}




// â•â•â• export.js â•â•â•
// â”€â”€â”€ 2Rat Radmelder â€“ Export-Modul â”€â”€â”€


/**
 * Alle Meldungen als GeoJSON exportieren
 * @returns {Object} GeoJSON FeatureCollection
 */
async function exportGeoJSON() {
  const reports = await getAllReports();

  const features = reports.map((report) => {
    const sub = getSubcategoryById(report.category, report.subcategory);

    return {
      type: 'Feature',
      geometry: {
        type: 'Point',
        coordinates: [report.longitude, report.latitude],
      },
      properties: {
        id: report.id,
        category: report.category,
        subcategory: report.subcategory,
        categoryLabel: sub?.label || report.subcategory,
        comment: report.comment || '',
        timestamp: report.timestamp,
        accuracy: report.accuracy,
        heading: report.heading,
        photoCount: report.photoCount || 0,
        syncStatus: report.syncStatus,
      },
    };
  });

  const geojson = {
    type: 'FeatureCollection',
    name: '2Rat_Radmelder_Export',
    crs: {
      type: 'name',
      properties: {
        name: 'urn:ogc:def:crs:OGC:1.3:CRS84',
      },
    },
    features,
    metadata: {
      exportDate: new Date().toISOString(),
      app: '2Rat Radmelder',
      version: '1.0.0',
      totalReports: features.length,
    },
  };

  return geojson;
}

/**
 * Alle Meldungen als CSV exportieren
 * @returns {string} CSV-String
 */
async function exportCSV() {
  const reports = await getAllReports();

  const headers = [
    'id',
    'latitude',
    'longitude',
    'accuracy',
    'timestamp',
    'category',
    'subcategory',
    'comment',
    'photoCount',
    'syncStatus',
  ];

  const rows = reports.map((r) =>
    headers.map((h) => {
      const val = r[h] ?? '';
      // CSV-Escaping: AnfÃ¼hrungszeichen verdoppeln
      const str = String(val).replace(/"/g, '""');
      return str.includes(',') || str.includes('"') || str.includes('\n')
        ? `"${str}"`
        : str;
    }).join(',')
  );

  // BOM fÃ¼r Excel-KompatibilitÃ¤t mit Umlauten
  return '\uFEFF' + headers.join(',') + '\n' + rows.join('\n');
}

/**
 * Datei zum Download anbieten
 * @param {string} content - Dateiinhalt
 * @param {string} filename - Dateiname
 * @param {string} mimeType - MIME-Type
 */
function downloadFile(content, filename, mimeType) {
  const blob = new Blob(
    [typeof content === 'string' ? content : JSON.stringify(content, null, 2)],
    { type: mimeType }
  );

  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = filename;
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  URL.revokeObjectURL(url);

  console.log(`[Export] ${filename} heruntergeladen`);
}

/**
 * GeoJSON-Export starten
 */
async function downloadGeoJSON() {
  const geojson = await exportGeoJSON();
  const date = new Date().toISOString().split('T')[0];
  downloadFile(geojson, `radmelder_${date}.geojson`, 'application/geo+json');
}

/**
 * CSV-Export starten
 */
async function downloadCSV() {
  const csv = await exportCSV();
  const date = new Date().toISOString().split('T')[0];
  downloadFile(csv, `radmelder_${date}.csv`, 'text/csv;charset=utf-8');
}

/**
 * QGIS-Stildatei (.qml) generieren
 * Farbcodierung nach Ampel-Schema
 */
function downloadQGISStyle() {
  const qml = `<?xml version="1.0" encoding="UTF-8"?>
<qgis version="3.28" styleCategories="Symbology">
  <renderer-v2 type="categorizedSymbol" attr="category" symbollevels="0">
    <categories>
      <category symbol="0" value="problems" label="Probleme/MÃ¤ngel"/>
      <category symbol="1" value="wishes" label="WÃ¼nsche"/>
      <category symbol="2" value="positive" label="Positiv"/>
    </categories>
    <symbols>
      <symbol type="marker" name="0">
        <layer class="SimpleMarker">
          <Option type="Map">
            <Option type="QString" value="circle" name="name"/>
            <Option type="QString" value="224,0,0,220" name="color"/>
            <Option type="QString" value="3.5" name="size"/>
          </Option>
        </layer>
      </symbol>
      <symbol type="marker" name="1">
        <layer class="SimpleMarker">
          <Option type="Map">
            <Option type="QString" value="circle" name="name"/>
            <Option type="QString" value="229,167,0,220" name="color"/>
            <Option type="QString" value="3.5" name="size"/>
          </Option>
        </layer>
      </symbol>
      <symbol type="marker" name="2">
        <layer class="SimpleMarker">
          <Option type="Map">
            <Option type="QString" value="circle" name="name"/>
            <Option type="QString" value="0,168,54,220" name="color"/>
            <Option type="QString" value="3.5" name="size"/>
          </Option>
        </layer>
      </symbol>
    </symbols>
  </renderer-v2>
</qgis>`;

  downloadFile(qml, 'radmelder_stil.qml', 'application/xml');
}




// â•â•â• sync.js â•â•â•
// â”€â”€â”€ 2Rat Radwegemelder â€“ Supabase Sync-Modul â”€â”€â”€

// â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
// â•‘  KONFIGURATION: Hier deine Supabase-Daten eintragen  â•‘
// â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SUPABASE_URL = 'https://vimsikjyoupihogmquul.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZpbXNpa2p5b3VwaWhvZ21xdXVsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA0NTIyMjYsImV4cCI6MjA4NjAyODIyNn0._Foa5ZVr4nwoOlZ4T-ORX0U4sNUjgRJJRyBDHvHV2vo';

let supabase = null;
let syncEnabled = false;
let deviceId = null;
let syncMode = 'wifi'; // 'auto' | 'wifi' | 'manual'

/**
 * Sync-Modul initialisieren
 */
async function initSync() {
  // Sync-Modus aus Einstellungen laden
  syncMode = await getSetting('syncMode', 'wifi');

  // PrÃ¼fen ob Supabase konfiguriert ist
  if (SUPABASE_URL === 'DEINE_SUPABASE_URL' || SUPABASE_ANON_KEY === 'DEIN_SUPABASE_ANON_KEY') {
    console.log('[Sync] Supabase nicht konfiguriert â€“ Sync deaktiviert');
    updateSyncUI('offline', 'Nur lokal');
    return;
  }

  try {
    // Supabase UMD exports unter verschiedenen Namen
    const sb = window.supabase;
    if (!sb) {
      console.log('[Sync] Supabase-Library nicht geladen');
      updateSyncUI('offline', 'Nur lokal');
      return;
    }
    
    if (typeof sb.createClient === 'function') {
      supabase = sb.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    } else if (sb.default && typeof sb.default.createClient === 'function') {
      supabase = sb.default.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    } else {
      throw new Error('createClient nicht gefunden. Keys: ' + Object.keys(sb).join(', '));
    }
    
    syncEnabled = true;
    console.log('[Sync] Supabase verbunden');
  } catch (err) {
    console.warn('[Sync] Supabase-Verbindung fehlgeschlagen:', err);
    updateSyncUI('error', 'Sync-Fehler');
    return;
  }

  // Anonyme GerÃ¤te-ID generieren/laden
  deviceId = localStorage.getItem('radmelder_device_id');
  if (!deviceId) {
    deviceId = crypto.randomUUID();
    localStorage.setItem('radmelder_device_id', deviceId);
  }

  // Online/Offline-Events
  window.addEventListener('online', onOnline);
  window.addEventListener('offline', onOffline);

  // Initiale Sync-PrÃ¼fung
  if (navigator.onLine) {
    updateSyncUI('synced', 'Online');
    attemptSync();
  } else {
    updateSyncUI('offline', 'Offline');
  }
}

/**
 * PrÃ¼fen ob aktuell gesynced werden soll
 */
function shouldSync() {
  if (!syncEnabled || !navigator.onLine) return false;
  if (syncMode === 'manual') return false;
  if (syncMode === 'wifi') return isOnWifi();
  return true; // auto
}

/**
 * PrÃ¼fen ob WLAN-Verbindung besteht
 * Nutzt die Network Information API (falls verfÃ¼gbar)
 */
function isOnWifi() {
  const conn = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
  if (conn) {
    return conn.type === 'wifi' || conn.type === 'ethernet';
  }
  // Fallback: Wenn API nicht verfÃ¼gbar, gehen wir optimistisch von WLAN aus
  // (auf Desktop ist das fast immer der Fall)
  return true;
}

/**
 * Sync versuchen (prÃ¼ft Modus)
 */
function attemptSync() {
  if (shouldSync()) {
    syncPendingReports();
  } else if (syncMode === 'wifi' && !isOnWifi()) {
    updatePendingInfo();
    updateSyncUI('pending', 'Wartet auf WLAN');
  } else if (syncMode === 'manual') {
    updatePendingInfo();
    updateSyncUI('pending', 'Manuell');
  }
}

/**
 * Online-Event: Ausstehende Meldungen synchronisieren
 */
function onOnline() {
  console.log('[Sync] Online');
  updateSyncUI('synced', 'Online');
  attemptSync();
}

/**
 * Offline-Event
 */
function onOffline() {
  console.log('[Sync] Offline');
  updateSyncUI('offline', 'Offline');
}

/**
 * Sync-Modus Ã¤ndern und speichern
 */
async function setSyncMode(mode) {
  syncMode = mode;
  await setSetting('syncMode', mode);
  console.log(`[Sync] Modus geÃ¤ndert: ${mode}`);

  // UI aktualisieren
  const manualSection = document.getElementById('manual-sync-section');
  if (manualSection) {
    manualSection.style.display = (mode === 'manual') ? 'block' : 'none';
  }

  // Bei Wechsel zu auto oder wifi: sofort versuchen
  if (mode !== 'manual' && navigator.onLine) {
    attemptSync();
  }
}

/**
 * Ausstehende Meldungen zÃ¤hlen und anzeigen
 */
async function updatePendingInfo() {
  const pending = await db.reports
    .where('syncStatus')
    .equals('local')
    .count();
  
  const el = document.getElementById('pending-count');
  if (el) {
    el.textContent = pending > 0
      ? `${pending} Meldung${pending > 1 ? 'en' : ''} warten auf Ãœbertragung`
      : 'Alle Meldungen synchronisiert âœ“';
  }
  return pending;
}

/**
 * Einzelne Meldung an Supabase senden
 */
async function syncReport(report) {
  if (!supabase || !syncEnabled) return false;

  try {
    // 1. Meldung hochladen
    const insertData = {
      id: report.id,
      latitude: report.latitude,
      longitude: report.longitude,
      accuracy: report.accuracy ? Math.round(report.accuracy) : null,
      heading: report.heading || null,
      timestamp: report.timestamp || new Date().toISOString(),
      category: report.category,
      subcategory: report.subcategory,
      comment: report.comment || '',
      photo_count: report.photoCount || 0,
      device_id: deviceId,
    };
    
    console.log('[Sync] Sende Meldung:', JSON.stringify(insertData));
    
    const { data, error } = await supabase
      .from('reports')
      .insert(insertData)
      .select()
      .single();

    if (error) {
      // Duplikat? Dann war schon gesynced
      if (error.code === '23505') {
        console.log(`[Sync] Meldung ${report.id} existiert bereits`);
        await db.reports.update(report.localId, { syncStatus: 'synced' });
        return true;
      }
      throw error;
    }

    // 2. Fotos hochladen
    const photos = await getPhotosForReport(report.localId);
    for (let i = 0; i < photos.length; i++) {
      await syncPhoto(report.id, photos[i], i);
    }

    // 3. Status in lokaler DB aktualisieren
    await db.reports.update(report.localId, {
      syncStatus: 'synced',
      serverId: data.id,
    });

    console.log(`[Sync] âœ“ Meldung ${report.id} synchronisiert`);
    return true;

  } catch (err) {
    console.error(`[Sync] âœ— Fehler bei Meldung ${report.id}:`, err.message);
    showToast('Sync-Fehler: ' + err.message, 'error');
    return false;
  }
}

/**
 * Foto an Supabase Storage senden
 */
async function syncPhoto(reportId, photo, index) {
  if (!supabase) return;

  try {
    // Base64 zu Blob konvertieren
    const base64Data = photo.data.split(',')[1];
    const byteCharacters = atob(base64Data);
    const byteNumbers = new Array(byteCharacters.length);
    for (let i = 0; i < byteCharacters.length; i++) {
      byteNumbers[i] = byteCharacters.charCodeAt(i);
    }
    const byteArray = new Uint8Array(byteNumbers);
    const blob = new Blob([byteArray], { type: 'image/jpeg' });

    // Pfad: photos/{report_id}/{index}.jpg
    const path = `${reportId}/${index}.jpg`;

    const { error: uploadError } = await supabase.storage
      .from('photos')
      .upload(path, blob, {
        contentType: 'image/jpeg',
        upsert: true,
      });

    if (uploadError) throw uploadError;

    // Foto-Metadaten in DB speichern
    await supabase
      .from('photos')
      .insert({
        report_id: reportId,
        storage_path: path,
      });

    console.log(`[Sync] âœ“ Foto ${index} fÃ¼r ${reportId} hochgeladen`);

  } catch (err) {
    console.error(`[Sync] âœ— Foto-Upload fehlgeschlagen:`, err.message);
  }
}

/**
 * Alle ausstehenden Meldungen synchronisieren
 */
async function syncPendingReports() {
  if (!supabase || !syncEnabled || !navigator.onLine) return;

  const pending = await db.reports
    .where('syncStatus')
    .equals('local')
    .toArray();

  if (pending.length === 0) {
    updateSyncUI('synced', 'Online');
    return;
  }

  updateSyncUI('pending', `Sync ${pending.length}â€¦`);
  console.log(`[Sync] ${pending.length} Meldungen ausstehend`);

  let synced = 0;
  for (const report of pending) {
    const success = await syncReport(report);
    if (success) synced++;
  }

  if (synced === pending.length) {
    updateSyncUI('synced', 'Online');
    showToast(`âœ“ ${synced} Meldung${synced > 1 ? 'en' : ''} synchronisiert`);
  } else {
    updateSyncUI('pending', `${pending.length - synced} ausstehend`);
  }
}

/**
 * Sync-UI aktualisieren
 */
function updateSyncUI(status, text) {
  const container = document.getElementById('sync-status');
  const textEl = document.getElementById('sync-text');
  if (!container || !textEl) return;

  container.className = `sync-status sync-status--${status}`;
  textEl.textContent = text;
}

/**
 * Alle Meldungen von Supabase laden (fÃ¼r Ã¶ffentliche Karte)
 */
async function fetchAllPublicReports() {
  if (!supabase || !syncEnabled) return [];

  try {
    const { data, error } = await supabase
      .from('reports')
      .select('*')
      .order('timestamp', { ascending: false })
      .limit(1000);

    if (error) throw error;
    return data || [];
  } catch (err) {
    console.error('[Sync] Fehler beim Laden Ã¶ffentlicher Meldungen:', err);
    return [];
  }
}


// â•â•â• app.js â•â•â•
// â”€â”€â”€ 2Rat Radmelder â€“ Haupt-App â”€â”€â”€


// â”€â”€â”€ App-State â”€â”€â”€
const state = {
  selectedCategory: null,   // 'problems' | 'wishes' | 'positive'
  selectedSubcategory: null, // z.B. 'surface'
  comment: '',
  photos: [],               // Array von { dataUrl, thumbnail }
  gpsPosition: null,
  gpsAccuracy: null,
};

// â”€â”€â”€ INITIALISIERUNG â”€â”€â”€

document.addEventListener('DOMContentLoaded', async () => {
  console.log('[App] 2Rat Radmelder wird geladen...');

  // 1. Datenbank
  initDB();

  // 2. Service Worker registrieren
  registerSW();

  // 3. Sync initialisieren
  initSync();

  // 4. Karte
  initMap('map-container');

  // 5. GPS starten
  startGPS(
    (pos) => {
      state.gpsPosition = pos;
      updateGPSDisplay(pos);
    },
    (err) => {
      console.warn('[App] GPS-Fehler:', err);
      showGPSError(err);
    }
  );

  // 6. Router
  initRouter({
    default: 'home',
    routes: {
      home: onHomeScreen,
      subcategory: onSubcategoryScreen,
      details: onDetailsScreen,
      confirm: onConfirmScreen,
      list: onListScreen,
      settings: onSettingsScreen,
    },
  });

  // 7. Event-Listener
  bindEvents();

  // 8. Meldungsanzahl aktualisieren
  updateReportBadge();

  console.log('[App] âœ“ Bereit');
});

// â”€â”€â”€ SERVICE WORKER â”€â”€â”€

async function registerSW() {
  if ('serviceWorker' in navigator) {
    try {
      const reg = await navigator.serviceWorker.register('./sw.js');
      console.log('[SW] Registriert:', reg.scope);
    } catch (err) {
      console.warn('[SW] Registrierung fehlgeschlagen:', err);
    }
  }
}

// â”€â”€â”€ SCREEN-CALLBACKS â”€â”€â”€

async function onHomeScreen() {
  // Meldungen auf Karte anzeigen
  const reports = await getAllReports();
  displayReports(reports);
  updateReportBadge();
}

function onSubcategoryScreen(params) {
  if (params?.type) {
    state.selectedCategory = params.type;
  }
  renderSubcategories();
}

function onDetailsScreen() {
  renderDetailsForm();
}

function onConfirmScreen() {
  // Nichts zu tun â€“ statischer Screen
}

async function onListScreen() {
  renderReportList();
}

async function onSettingsScreen() {
  // Aktuellen Sync-Modus in Radio-Buttons setzen
  const radio = document.querySelector(`input[name="syncMode"][value="${syncMode}"]`);
  if (radio) radio.checked = true;

  // Manuell-Section anzeigen/verstecken
  const manualSection = document.getElementById('manual-sync-section');
  if (manualSection) {
    manualSection.style.display = (syncMode === 'manual') ? 'block' : 'none';
  }

  // Ausstehende Meldungen anzeigen
  updatePendingInfo();
}

// â”€â”€â”€ RENDERING â”€â”€â”€

function renderSubcategories() {
  const cat = CATEGORIES[state.selectedCategory];
  if (!cat) return;

  const container = document.getElementById('subcategory-list');
  const title = document.getElementById('subcategory-title');

  title.textContent = cat.label;
  title.style.color = cat.color;

  container.innerHTML = cat.items
    .map(
      (item) => `
    <button class="category-card" data-sub="${item.id}" style="--accent: ${cat.color}; --accent-bg: ${cat.bgColor}; --accent-border: ${cat.color}20">
      <div class="category-card__icon" style="background:${cat.bgColor}; font-size:22px;">${item.icon}</div>
      <div class="category-card__text">
        <div class="category-card__label">${item.label}</div>
        <div class="category-card__desc">${item.description}</div>
      </div>
      <div class="category-card__arrow">â€º</div>
    </button>
  `
    )
    .join('');

  // Click-Handler
  container.querySelectorAll('.category-card').forEach((btn) => {
    btn.addEventListener('click', () => {
      state.selectedSubcategory = btn.dataset.sub;
      navigate('details');
    });
  });
}

let detailMap = null;
let detailMarker = null;

function renderDetailsForm() {
  const sub = getSubcategoryById(state.selectedCategory, state.selectedSubcategory);
  if (!sub) return;

  document.getElementById('detail-title').textContent = `${sub.icon} ${sub.label}`;
  document.getElementById('detail-description').textContent = sub.description;
  document.getElementById('comment-input').value = state.comment;

  // Detail-Karte initialisieren
  setTimeout(() => {
    const container = document.getElementById('detail-map');
    if (!container) return;
    
    // Alte Karte entfernen
    if (detailMap) {
      detailMap.remove();
      detailMap = null;
    }

    const pos = getCurrentPosition();
    const center = pos ? [pos.latitude, pos.longitude] : [49.41, 6.78];
    const zoom = pos ? 17 : 14;

    detailMap = L.map('detail-map', {
      center: center,
      zoom: zoom,
      zoomControl: false,
      dragging: true,
      scrollWheelZoom: false,
    });

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap',
      maxZoom: 19,
    }).addTo(detailMap);

    // Marker fÃ¼r aktuelle Position
    if (pos) {
      detailMarker = L.marker(center, {
        draggable: true,
      }).addTo(detailMap);

      // Wenn Marker verschoben wird, Position updaten
      detailMarker.on('dragend', function(e) {
        const latlng = e.target.getLatLng();
        state.gpsPosition = {
          ...state.gpsPosition,
          latitude: latlng.lat,
          longitude: latlng.lng,
          accuracy: 0, // Manuell gesetzt
        };
        const gpsInfo = document.getElementById('detail-gps-info');
        if (gpsInfo) {
          gpsInfo.textContent = `ğŸ“ Manuell gesetzt Â· ${latlng.lat.toFixed(5)}, ${latlng.lng.toFixed(5)}`;
        }
      });
    }

    // Karte neu layouten (wichtig nach Screen-Wechsel)
    setTimeout(() => detailMap.invalidateSize(), 100);
  }, 150);

  // GPS-Anzeige aktualisieren
  if (state.gpsPosition) {
    updateGPSDisplay(state.gpsPosition);
    const gpsInfo = document.getElementById('detail-gps-info');
    if (gpsInfo) {
      gpsInfo.textContent = `GPS: Â±${state.gpsPosition.accuracy}m Â· ${state.gpsPosition.latitude.toFixed(5)}, ${state.gpsPosition.longitude.toFixed(5)}`;
    }
  }

  // Fotos anzeigen
  renderPhotoPreview();
}

function renderPhotoPreview() {
  const container = document.getElementById('photo-preview');
  container.innerHTML =
    state.photos
      .map(
        (p, i) => `
    <div class="photo-thumb">
      <img src="${p.thumbnail}" alt="Foto ${i + 1}">
      <button class="photo-thumb__remove" data-index="${i}">Ã—</button>
    </div>
  `
      )
      .join('') +
    `<button id="btn-add-photo" class="photo-add">
      <span>+</span>
      <small>Foto</small>
    </button>`;

  // Event-Handler
  document.getElementById('btn-add-photo')?.addEventListener('click', handleAddPhoto);
  container.querySelectorAll('.photo-thumb__remove').forEach((btn) => {
    btn.addEventListener('click', () => {
      state.photos.splice(parseInt(btn.dataset.index), 1);
      renderPhotoPreview();
    });
  });
}

async function renderReportList() {
  const reports = await getAllReports();
  const container = document.getElementById('report-list');

  if (reports.length === 0) {
    container.innerHTML = `
      <div class="empty-state">
        <div class="empty-state__icon">ğŸ—ºï¸</div>
        <p>Noch keine Meldungen vorhanden.</p>
        <button onclick="window.location.hash='home'" style="margin-top:16px; background:linear-gradient(135deg,#1A5FA8,#2D8C28); color:#fff; border:none; border-radius:14px; padding:14px 28px; font-size:15px; font-weight:700; cursor:pointer; box-shadow:0 4px 16px rgba(26,95,168,0.3);">
          + Erste Meldung erstellen
        </button>
      </div>`;
    return;
  }

  container.innerHTML = reports
    .map((r) => {
      const cat = CATEGORIES[r.category];
      const sub = getSubcategoryById(r.category, r.subcategory);
      const date = new Date(r.timestamp).toLocaleString('de-DE');

      return `
      <div class="report-item" style="--cat-bg: ${cat?.bgColor || '#f0f0f0'}">
        <div class="report-item__icon" style="background: ${cat?.bgColor}">${sub?.icon || 'ğŸ“'}</div>
        <div class="report-item__text">
          <div class="report-item__label">${sub?.label || r.subcategory}</div>
          <div class="report-item__meta">${date} Â· ${r.photoCount ? 'ğŸ“· ' + r.photoCount : 'Kein Foto'}</div>
          ${r.comment ? `<div class="report-item__comment">â€${r.comment.substring(0, 60)}${r.comment.length > 60 ? '...' : ''}"</div>` : ''}
        </div>
        <button class="report-item__delete" data-id="${r.localId}" title="LÃ¶schen">ğŸ—‘ï¸</button>
      </div>`;
    })
    .join('');

  // LÃ¶schen-Handler
  container.querySelectorAll('.report-item__delete').forEach((btn) => {
    btn.addEventListener('click', async () => {
      if (confirm('Meldung wirklich lÃ¶schen?')) {
        await deleteReport(parseInt(btn.dataset.id));
        renderReportList();
        updateReportBadge();
      }
    });
  });
}

// â”€â”€â”€ EVENT-HANDLER â”€â”€â”€

function bindEvents() {
  // Hauptkategorien
  document.querySelectorAll('[data-category]').forEach((btn) => {
    btn.addEventListener('click', () => {
      state.selectedCategory = btn.dataset.category;
      state.selectedSubcategory = null;
      state.comment = '';
      state.photos = [];
      navigate('subcategory', { type: btn.dataset.category });
    });
  });

  // ZurÃ¼ck-Buttons
  document.querySelectorAll('[data-back]').forEach((btn) => {
    btn.addEventListener('click', goBack);
  });

  // Meldung speichern
  document.getElementById('btn-save-report')?.addEventListener('click', handleSaveReport);

  // Meine Meldungen
  document.getElementById('btn-my-reports')?.addEventListener('click', () => navigate('list'));

  // GPS zentrieren
  document.getElementById('btn-center-gps')?.addEventListener('click', centerOnPosition);

  // Neue Meldung (nach BestÃ¤tigung)
  document.getElementById('btn-new-report')?.addEventListener('click', () => navigate('home'));

  // Export-Buttons
  document.getElementById('btn-export-geojson')?.addEventListener('click', downloadGeoJSON);
  document.getElementById('btn-export-csv')?.addEventListener('click', downloadCSV);
  document.getElementById('btn-export-qgis')?.addEventListener('click', downloadQGISStyle);

  // Kommentar speichern bei Eingabe
  document.getElementById('comment-input')?.addEventListener('input', (e) => {
    state.comment = e.target.value;
  });

  // Sync-Modus wÃ¤hlen
  document.querySelectorAll('input[name="syncMode"]').forEach((radio) => {
    radio.addEventListener('change', (e) => {
      setSyncMode(e.target.value);
    });
  });

  // Manueller Sync-Button
  document.getElementById('btn-manual-sync')?.addEventListener('click', async () => {
    if (!navigator.onLine) {
      showToast('âš ï¸ Keine Internetverbindung');
      return;
    }
    showToast('ğŸ“¡ Synchronisiereâ€¦');
    await syncPendingReports();
    updatePendingInfo();
  });
}

// â”€â”€â”€ AKTIONEN â”€â”€â”€

async function handleAddPhoto() {
  if (state.photos.length >= 3) {
    showToast('Maximal 3 Fotos');
    return;
  }

  try {
    const photo = await capturePhoto({ maxWidth: 1280, quality: 0.8 });
    state.photos.push(photo);
    renderPhotoPreview();
    showToast('ğŸ“· Foto hinzugefÃ¼gt');
  } catch (err) {
    if (err.message !== 'Abgebrochen') {
      showToast('Foto konnte nicht aufgenommen werden');
    }
  }
}

async function handleSaveReport() {
  const pos = getCurrentPosition();

  if (!pos) {
    showToast('âš ï¸ Kein GPS-Signal â€“ bitte warten');
    return;
  }

  // Meldung speichern
  const localId = await saveReport({
    latitude: pos.latitude,
    longitude: pos.longitude,
    accuracy: pos.accuracy,
    heading: pos.heading,
    category: state.selectedCategory,
    subcategory: state.selectedSubcategory,
    comment: state.comment,
    photoCount: state.photos.length,
  });

  // Fotos speichern
  for (const photo of state.photos) {
    await savePhoto(localId, photo.dataUrl);
  }

  // Sync versuchen (im Hintergrund, respektiert Sync-Modus)
  if (syncEnabled && navigator.onLine && shouldSync()) {
    const report = await getReport(localId);
    syncReport(report).catch(err => console.warn('[Sync] Hintergrund-Sync fehlgeschlagen:', err));
  }

  // State zurÃ¼cksetzen
  state.selectedCategory = null;
  state.selectedSubcategory = null;
  state.comment = '';
  state.photos = [];

  navigate('confirm');
}

// â”€â”€â”€ UI-HELPER â”€â”€â”€

function updateGPSDisplay(pos) {
  const el = document.getElementById('gps-status');
  if (el) {
    el.innerHTML = `<span class="gps-dot"></span> GPS Â±${pos.accuracy}m`;
    el.classList.toggle('gps-status--good', pos.accuracy <= 10);
    el.classList.toggle('gps-status--ok', pos.accuracy > 10 && pos.accuracy <= 30);
    el.classList.toggle('gps-status--poor', pos.accuracy > 30);
  }
}

function showGPSError(msg) {
  const el = document.getElementById('gps-status');
  if (el) {
    el.innerHTML = `<span class="gps-dot gps-dot--error"></span> Kein GPS`;
  }
}

async function updateReportBadge() {
  const count = await getReportCount();
  const badge = document.getElementById('report-badge');
  if (badge) {
    badge.textContent = count;
    badge.style.display = count > 0 ? 'flex' : 'none';
  }
}

let toastTimeout;
function showToast(message) {
  let toast = document.getElementById('toast');
  if (!toast) {
    toast = document.createElement('div');
    toast.id = 'toast';
    toast.className = 'toast';
    document.body.appendChild(toast);
  }

  toast.textContent = message;
  toast.classList.add('toast--visible');

  clearTimeout(toastTimeout);
  toastTimeout = setTimeout(() => {
    toast.classList.remove('toast--visible');
  }, 2500);
}

</script>
</body>
</html>