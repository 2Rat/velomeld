<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#1A5FA8">
  <meta name="description" content="2Rat Radwegemelder â€“ Radverkehrsinfrastruktur erfassen und MÃ¤ngel melden">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Radmelder">
  <title>2Rat Radwegemelder</title>
  <link rel="manifest" href="./manifest.json">
  <link rel="apple-touch-icon" href="data:image/png;base64,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">
  
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/dexie@3/dist/dexie.js"></script>
  <style>
/* â”€â”€â”€ 2Rat Radmelder â€“ Stylesheet â”€â”€â”€ */

/* â”€â”€â”€ CSS Variables â”€â”€â”€ */
:root {
  --blue: #1A5FA8;
  --blue-dark: #0E3F73;
  --blue-light: #DDEAF8;
  --green: #2D8C28;
  --green-dark: #1B6B17;
  --green-light: #E0F2DE;
  --gray: #3D4F58;
  --gray-light: #F0F2F4;
  --gray-mid: #8A9BA4;
  --white: #FFFFFF;

  /* Ampelfarben */
  --red: #E00000;
  --red-light: #FFAAAA;
  --yellow: #E5A700;
  --yellow-light: #FFE082;
  --ampel-green: #00A836;
  --ampel-green-light: #A5E6B5;

  --radius-sm: 10px;
  --radius-md: 14px;
  --radius-lg: 20px;
  --radius-xl: 24px;
  --shadow-sm: 0 1px 4px rgba(0,0,0,0.06);
  --shadow-md: 0 2px 12px rgba(0,0,0,0.1);
  --shadow-lg: 0 4px 24px rgba(0,0,0,0.12);

  --font: 'DM Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
}

/* â”€â”€â”€ Reset â”€â”€â”€ */
*, *::before, *::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html, body {
  height: 100%;
  font-family: var(--font);
  color: var(--gray);
  background: var(--gray-light);
  -webkit-font-smoothing: antialiased;
  -webkit-tap-highlight-color: transparent;
  overflow: hidden;
  user-select: none;
}

button {
  font-family: var(--font);
  border: none;
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
}

input, textarea {
  font-family: var(--font);
}

/* â”€â”€â”€ App Container â”€â”€â”€ */
.app {
  height: 100%;
  display: flex;
  flex-direction: column;
  max-width: 480px;
  margin: 0 auto;
  background: var(--white);
  position: relative;
  overflow: hidden;
}

/* â”€â”€â”€ Header â”€â”€â”€ */
.header {
  display: flex;
  align-items: center;
  padding: 12px 16px;
  background: var(--white);
  border-bottom: 1px solid var(--gray-light);
  z-index: 20;
  flex-shrink: 0;
}

.header__logo {
  display: flex;
  align-items: baseline;
  gap: 1px;
  font-weight: 700;
  font-size: 18px;
}

.header__logo-2 { color: var(--blue); }
.header__logo-rat { color: var(--green); }
.header__logo-sub {
  font-size: 12px;
  font-weight: 400;
  color: var(--gray-mid);
  margin-left: 6px;
}

/* â”€â”€â”€ Screens â”€â”€â”€ */
[data-screen] {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: none;
  flex-direction: column;
  z-index: 1;
}

[data-screen].screen--active {
  display: flex;
  z-index: 10;
  animation: screenSlideIn 0.25s ease-out;
}

@keyframes screenSlideIn {
  from {
    opacity: 0;
    transform: translateX(20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

/* â”€â”€â”€ Home Screen â”€â”€â”€ */
.map-container {
  flex: 1;
  min-height: 0;
  position: relative;
}

#map-container {
  width: 100%;
  height: 100%;
}

.home-bottom {
  background: var(--white);
  border-radius: var(--radius-xl) var(--radius-xl) 0 0;
  padding: 24px 20px 28px;
  box-shadow: 0 -4px 24px rgba(0,0,0,0.08);
  position: relative;
  z-index: 5;
  flex-shrink: 0;
}

.home-bottom__title {
  font-size: 20px;
  font-weight: 700;
  margin-bottom: 4px;
}

.home-bottom__subtitle {
  font-size: 13px;
  color: var(--gray-mid);
  margin-bottom: 18px;
}

/* â”€â”€â”€ Kategorie-Buttons (Home) â”€â”€â”€ */
.cat-btn {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 16px 18px;
  border-radius: var(--radius-md);
  width: 100%;
  text-align: left;
  transition: transform 0.15s ease;
  margin-bottom: 10px;
}

.cat-btn { box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
.cat-btn:active { transform: scale(0.98); }

.cat-btn--problems { background: var(--red-light); }
.cat-btn--wishes { background: var(--yellow-light); }
.cat-btn--positive { background: var(--ampel-green-light); }

.cat-btn__icon {
  width: 48px;
  height: 48px;
  border-radius: var(--radius-md);
  background: var(--white);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  flex-shrink: 0;
}

.cat-btn__label {
  font-weight: 700;
  font-size: 16px;
}

.cat-btn--problems .cat-btn__label { color: var(--red); }
.cat-btn--wishes .cat-btn__label { color: var(--yellow); }
.cat-btn--positive .cat-btn__label { color: var(--ampel-green); }

.cat-btn__count {
  font-size: 12px;
  color: var(--gray-mid);
  margin-top: 2px;
}

.cat-btn__arrow {
  margin-left: auto;
  font-size: 18px;
}

.cat-btn--problems .cat-btn__arrow { color: var(--red); }
.cat-btn--wishes .cat-btn__arrow { color: var(--yellow); }
.cat-btn--positive .cat-btn__arrow { color: var(--ampel-green); }

/* â”€â”€â”€ Category Cards (Subcategory Screen) â”€â”€â”€ */
.screen-header {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 16px 20px;
  background: var(--white);
  border-bottom: 2px solid var(--gray-light);
  flex-shrink: 0;
}

.screen-header__back {
  background: none;
  font-size: 22px;
  color: var(--gray);
  padding: 4px;
}

.screen-header__title {
  font-size: 17px;
  font-weight: 700;
}

.screen-header__subtitle {
  font-size: 12px;
  color: var(--gray-mid);
}

.screen-body {
  flex: 1;
  overflow-y: auto;
  padding: 12px 16px;
  -webkit-overflow-scrolling: touch;
}

.category-card {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 14px 16px;
  border: 1px solid #E8EBED;
  border-left: 5px solid var(--accent, var(--blue));
  border-radius: var(--radius-md);
  background: var(--white);
  width: 100%;
  text-align: left;
  box-shadow: var(--shadow-sm);
  margin-bottom: 8px;
  transition: all 0.2s ease;
}

.category-card:active {
  border-color: var(--accent, var(--blue));
  background: color-mix(in srgb, var(--accent, var(--blue)) 5%, white);
}

.category-card__icon {
  width: 44px;
  height: 44px;
  border-radius: 12px;
  background: var(--accent-bg, var(--gray-light));
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 22px;
  flex-shrink: 0;
}

.category-card__label {
  font-weight: 600;
  font-size: 15px;
  color: #2D3339;
}

.category-card__desc {
  font-size: 12px;
  color: var(--gray-mid);
  margin-top: 2px;
}

.category-card__arrow {
  margin-left: auto;
  font-size: 18px;
  color: var(--gray-mid);
}

/* â”€â”€â”€ Details Screen â”€â”€â”€ */
.detail-section {
  margin-bottom: 20px;
}

.detail-label {
  font-size: 13px;
  font-weight: 600;
  margin-bottom: 8px;
}

.detail-map {
  height: 200px;
  border-radius: var(--radius-md);
  overflow: hidden;
  border: 1px solid var(--gray-light);
}

.detail-map-hint {
  font-size: 11px;
  color: var(--gray-mid);
  margin-top: 6px;
}

/* â”€â”€â”€ Photos â”€â”€â”€ */
.photo-grid {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.photo-thumb {
  width: 72px;
  height: 72px;
  border-radius: 12px;
  overflow: hidden;
  position: relative;
}

.photo-thumb img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.photo-thumb__remove {
  position: absolute;
  top: -4px;
  right: -4px;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: var(--red);
  color: var(--white);
  font-size: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 2px solid var(--white);
}

.photo-add {
  width: 72px;
  height: 72px;
  border-radius: 12px;
  border: 2px dashed var(--gray-mid);
  background: transparent;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 2px;
  color: var(--gray-mid);
  font-size: 24px;
  transition: all 0.2s;
}

.photo-add small {
  font-size: 9px;
  font-weight: 500;
}

.photo-add:active {
  border-color: var(--blue);
  color: var(--blue);
}

/* â”€â”€â”€ Comment â”€â”€â”€ */
.comment-input {
  width: 100%;
  padding: 12px 14px;
  border-radius: 12px;
  border: 1.5px solid var(--gray-light);
  font-size: 14px;
  color: var(--gray);
  resize: vertical;
  outline: none;
  transition: border-color 0.2s;
  min-height: 80px;
}

.comment-input:focus {
  border-color: var(--blue);
}

.comment-input::placeholder {
  color: var(--gray-mid);
}

/* â”€â”€â”€ Primary Button â”€â”€â”€ */
.btn-primary {
  width: 100%;
  padding: 16px;
  border-radius: var(--radius-md);
  background: linear-gradient(135deg, var(--blue), var(--green));
  color: var(--white);
  font-size: 16px;
  font-weight: 700;
  box-shadow: 0 4px 16px rgba(26,95,168,0.3);
  transition: transform 0.15s ease, box-shadow 0.15s ease;
}

.btn-primary:active {
  transform: scale(0.98);
  box-shadow: 0 2px 8px rgba(26,95,168,0.2);
}

.btn-secondary {
  width: 100%;
  padding: 14px;
  border-radius: var(--radius-md);
  border: 2px solid var(--blue);
  background: transparent;
  color: var(--blue);
  font-size: 15px;
  font-weight: 600;
}

/* â”€â”€â”€ GPS Status â”€â”€â”€ */
.gps-status {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 12px;
  color: var(--gray-mid);
  padding: 8px 14px;
  background: var(--white);
  border-radius: 12px;
  box-shadow: var(--shadow-md);
}

.gps-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  animation: pulse 2s ease-in-out infinite;
}

.gps-status--good .gps-dot { background: var(--ampel-green); }
.gps-status--ok .gps-dot { background: var(--yellow); }
.gps-status--poor .gps-dot { background: var(--red); }
.gps-dot--error { background: var(--red); animation: none; }

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.4; }
}

/* â”€â”€â”€ Confirm Screen â”€â”€â”€ */
.confirm-screen {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  padding: 32px;
  background: linear-gradient(180deg, #fff 0%, #F0F7FF 100%);
  height: 100%;
}

.confirm-icon {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--ampel-green), var(--blue));
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 36px;
  color: var(--white);
  margin-bottom: 20px;
  box-shadow: 0 8px 32px rgba(0,168,54,0.3);
  animation: scaleIn 0.4s ease-out;
}

@keyframes scaleIn {
  0% { transform: scale(0); }
  70% { transform: scale(1.1); }
  100% { transform: scale(1); }
}

.confirm-title {
  font-size: 22px;
  font-weight: 700;
  margin-bottom: 8px;
}

.confirm-text {
  font-size: 14px;
  color: var(--gray-mid);
  line-height: 1.5;
  margin-bottom: 32px;
}

/* â”€â”€â”€ Report List â”€â”€â”€ */
.report-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 14px 16px;
  border-radius: var(--radius-md);
  background: var(--white);
  box-shadow: var(--shadow-sm);
  margin-bottom: 8px;
}

.report-item__icon {
  width: 42px;
  height: 42px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  flex-shrink: 0;
}

.report-item__label {
  font-weight: 600;
  font-size: 14px;
}

.report-item__meta {
  font-size: 11px;
  color: var(--gray-mid);
  margin-top: 2px;
}

.report-item__comment {
  font-size: 12px;
  color: var(--gray);
  opacity: 0.7;
  margin-top: 4px;
}

.report-item__delete {
  background: none;
  font-size: 16px;
  padding: 4px;
  opacity: 0.4;
  flex-shrink: 0;
}

.report-item__delete:active { opacity: 1; }

/* â”€â”€â”€ Empty State â”€â”€â”€ */
.empty-state {
  text-align: center;
  padding: 48px 20px;
}

.empty-state__icon {
  font-size: 48px;
  margin-bottom: 12px;
}

.empty-state p {
  color: var(--gray-mid);
  font-size: 14px;
  line-height: 1.5;
}

/* â”€â”€â”€ Report Badge â”€â”€â”€ */
.report-badge {
  position: absolute;
  top: 16px;
  right: 16px;
  z-index: 15;
}

.report-badge__btn {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 16px;
  background: var(--white);
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-md);
  font-size: 13px;
  font-weight: 600;
  color: var(--gray);
}

/* â”€â”€â”€ Export Buttons â”€â”€â”€ */
.export-btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 8px 14px;
  background: var(--blue-light);
  border-radius: var(--radius-sm);
  font-size: 12px;
  font-weight: 600;
  color: var(--blue);
}

.export-btn:active {
  background: var(--blue);
  color: var(--white);
}

/* â”€â”€â”€ Toast â”€â”€â”€ */
.toast {
  position: fixed;
  bottom: 24px;
  left: 50%;
  transform: translateX(-50%) translateY(80px);
  background: var(--gray);
  color: var(--white);
  padding: 10px 20px;
  border-radius: 12px;
  font-size: 13px;
  font-weight: 500;
  box-shadow: 0 4px 16px rgba(0,0,0,0.2);
  z-index: 100;
  transition: transform 0.3s ease, opacity 0.3s ease;
  opacity: 0;
  pointer-events: none;
}

.toast--visible {
  transform: translateX(-50%) translateY(0);
  opacity: 1;
}

/* â”€â”€â”€ Leaflet Overrides â”€â”€â”€ */
.leaflet-control-zoom a {
  border-radius: 10px !important;
}

.leaflet-popup-content-wrapper {
  border-radius: 12px !important;
  box-shadow: var(--shadow-md) !important;
}

  </style>
</head>
<body>


<div class="app">

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- SCREEN: Home (Karte + Kategorien)          -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div data-screen="home" class="screen--active">
    
    <!-- Header mit Logo -->
    <div style="display:flex; flex-direction:column; align-items:center; justify-content:center; padding:16px 20px 12px; background:#fff; border-bottom:none; z-index:20; flex-shrink:0; box-shadow:0 2px 8px rgba(0,0,0,0.06);">
      <div style="font-weight:800; font-size:26px; letter-spacing:4px; text-transform:uppercase;">
        <span style="color:#1A5FA8;">Radwege</span><span style="color:#2D8C28;">melder</span>
      </div>
      <div style="font-size:11px; color:#8A9BA4; font-weight:500; margin-top:3px; letter-spacing:0.3px;">by 2Rat Â· PlanungsbÃ¼ro fÃ¼r Radverkehr</div>
    </div>
    <!-- Karte -->
    <div class="map-container">
      <div id="map-container"></div>

      <!-- GPS-Status (Overlay auf Karte) -->
      <div style="position:absolute; top:12px; left:12px; z-index:15;">
        <div id="gps-status" class="gps-status">
          <span class="gps-dot"></span> GPS wird gesuchtâ€¦
        </div>
      </div>

      <!-- Meine Meldungen Badge (Overlay) -->
      <div class="report-badge">
        <button id="btn-my-reports" class="report-badge__btn">
          ğŸ“‹ <span id="report-badge" style="display:none;">0</span> Meldungen ansehen
        </button>
      </div>
    </div>

    <!-- Unterer Bereich: Kategorien -->
    <div class="home-bottom">
      <h2 class="home-bottom__title">Was mÃ¶chtest du melden?</h2>
      <p class="home-bottom__subtitle">WÃ¤hle eine Kategorie fÃ¼r deine Meldung.</p>

      <!-- Problem -->
      <button class="cat-btn cat-btn--problems" data-category="problems">
        <div class="cat-btn__icon">âš ï¸</div>
        <div>
          <div class="cat-btn__label">Problem melden</div>
          <div class="cat-btn__count">11 Unterkategorien</div>
        </div>
        <div class="cat-btn__arrow">â€º</div>
      </button>

      <!-- Wunsch -->
      <button class="cat-btn cat-btn--wishes" data-category="wishes">
        <div class="cat-btn__icon">ğŸ’¬</div>
        <div>
          <div class="cat-btn__label">Wunsch Ã¤uÃŸern</div>
          <div class="cat-btn__count">6 Unterkategorien</div>
        </div>
        <div class="cat-btn__arrow">â€º</div>
      </button>

      <!-- Positiv -->
      <button class="cat-btn cat-btn--positive" data-category="positive">
        <div class="cat-btn__icon">ğŸ‘</div>
        <div>
          <div class="cat-btn__label">Lob aussprechen</div>
          <div class="cat-btn__count">3 Unterkategorien</div>
        </div>
        <div class="cat-btn__arrow">â€º</div>
      </button>

      <!-- Footer -->
      <div style="text-align:center; margin-top:16px; padding-top:12px; border-top:1px solid #F0F2F4; font-size:11px; color:#8A9BA4;">
        <a href="./datenschutz.html" style="color:#8A9BA4; text-decoration:none;">ğŸ”’ Datenschutz</a>
        &nbsp;Â·&nbsp;
        <span>v1.0</span>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- SCREEN: Unterkategorie wÃ¤hlen              -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div data-screen="subcategory">
    <div class="screen-header">
      <button class="screen-header__back" data-back>â†</button>
      <div>
        <h3 class="screen-header__title" id="subcategory-title"></h3>
        <p class="screen-header__subtitle">Was genau mÃ¶chtest du melden?</p>
      </div>
    </div>
    <div class="screen-body" id="subcategory-list">
      <!-- Wird dynamisch gefÃ¼llt -->
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- SCREEN: Details (Standort, Foto, Kommentar)-->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div data-screen="details">
    <div class="screen-header">
      <button class="screen-header__back" data-back>â†</button>
      <div>
        <h3 class="screen-header__title" id="detail-title"></h3>
        <p class="screen-header__subtitle" id="detail-description"></p>
      </div>
    </div>
    <div class="screen-body">

      <!-- Standort -->
      <div class="detail-section">
        <div class="detail-label">ğŸ“ Standort</div>
        <div class="detail-map" id="detail-map"></div>
        <div style="display:flex; align-items:center; justify-content:space-between; margin-top:8px;">
          <p class="detail-map-hint" id="detail-gps-info">Dein aktueller GPS-Standort wird verwendet</p>
          <button onclick="centerOnPosition()" style="background:none; border:1px solid #1A5FA8; color:#1A5FA8; border-radius:8px; padding:4px 10px; font-size:11px; font-weight:600; cursor:pointer;">ğŸ“ Zentrieren</button>
        </div>
      </div>

      <!-- Foto -->
      <div class="detail-section">
        <div class="detail-label">ğŸ“· Foto (optional)</div>
        <div class="photo-grid" id="photo-preview">
          <button id="btn-add-photo" class="photo-add">
            <span>+</span>
            <small>Foto</small>
          </button>
        </div>
      </div>

      <!-- Kommentar -->
      <div class="detail-section">
        <div class="detail-label">ğŸ’¬ Kommentar (optional)</div>
        <textarea
          id="comment-input"
          class="comment-input"
          placeholder="Beschreibe das Problem genauerâ€¦"
          rows="3"
        ></textarea>
      </div>

      <!-- Speichern -->
      <div style="padding:8px 0 16px;">
        <button id="btn-save-report" class="btn-primary">
          âœ“ Meldung speichern
        </button>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- SCREEN: BestÃ¤tigung                        -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div data-screen="confirm">
    <div class="confirm-screen">
      <div class="confirm-icon">âœ“</div>
      <h2 class="confirm-title">Danke fÃ¼r deine Meldung!</h2>
      <p class="confirm-text">
        Deine Meldung wurde lokal auf deinem GerÃ¤t gespeichert.<br>
        Du kannst sie jederzeit als GeoJSON oder CSV exportieren.
      </p>
      <button id="btn-new-report" class="btn-primary" style="margin-bottom:12px;">
        + Weitere Meldung erstellen
      </button>
      <button class="btn-secondary" onclick="window.location.hash='list'" style="margin-bottom:8px;">
        ğŸ“‹ Meine Meldungen ansehen
      </button>
      <button class="btn-secondary" onclick="window.location.hash='home'" style="border-color:#8A9BA4; color:#8A9BA4;">
        ğŸ—ºï¸ ZurÃ¼ck zur Karte
      </button>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- SCREEN: Meine Meldungen                    -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div data-screen="list">
    <div class="screen-header">
      <button class="screen-header__back" data-back>â†</button>
      <h3 class="screen-header__title" style="flex:1;">Meine Meldungen</h3>
      <div style="display:flex; gap:6px;">
        <button id="btn-export-geojson" class="export-btn">ğŸ“¥ GeoJSON</button>
        <button id="btn-export-csv" class="export-btn">ğŸ“¥ CSV</button>
        <button id="btn-export-qgis" class="export-btn" style="background:#E0F2DE; color:#2D8C28;">ğŸ¨ QGIS</button>
      </div>
    </div>
    <div class="screen-body" id="report-list">
      <!-- Wird dynamisch gefÃ¼llt -->
    </div>
  </div>

</div>

<!-- App JS (als Module) -->



<script>
// â•â•â• categories.js â•â•â•
// â”€â”€â”€ 2Rat Radmelder â€“ Kategorien-System â”€â”€â”€

const CATEGORIES = {
  // â”€â”€â”€ ROT: Probleme / MÃ¤ngel â”€â”€â”€
  problems: {
    id: 'problems',
    label: 'Problem melden',
    emoji: 'âš ï¸',
    color: '#E00000',
    bgColor: '#FF9999',
    items: [
      {
        id: 'surface',
        icon: 'ğŸ•³ï¸',
        label: 'OberflÃ¤che',
        description: 'SchlaglÃ¶cher, WurzelaufbrÃ¼che, Rillen, Kopfsteinpflaster',
        tags: ['schlagloch', 'wurzel', 'rille', 'pflaster', 'belag'],
      },
      {
        id: 'narrow',
        icon: 'â†”ï¸',
        label: 'Engstelle',
        description: 'Zu schmaler Radweg, Hindernisse, Poller',
        tags: ['eng', 'schmal', 'hindernis', 'poller', 'breite'],
      },
      {
        id: 'crossing',
        icon: 'ğŸ”€',
        label: 'Kreuzung / Knoten',
        description: 'GefÃ¤hrliche FÃ¼hrung, schlechte Sicht, fehlende Signalisierung',
        tags: ['kreuzung', 'knoten', 'sicht', 'signal', 'ampel'],
      },
      {
        id: 'traverse',
        icon: 'ğŸš¶',
        label: 'Querung',
        description: 'Fehlende Querungshilfe, Umwege, Barrieren',
        tags: ['querung', 'umweg', 'barriere', 'Ã¼berweg'],
      },
      {
        id: 'conflict',
        icon: 'ğŸ’¥',
        label: 'Konflikte',
        description: 'Dooring-Gefahr, FuÃŸgÃ¤ngerkonflikte, Kfz-Konflikte',
        tags: ['dooring', 'fussgÃ¤nger', 'auto', 'konflikt', 'gefahr'],
      },
      {
        id: 'parking',
        icon: 'ğŸ…¿ï¸',
        label: 'Parken',
        description: 'Zugeparkte Radwege, Falschparker, fehlende Kontrolle',
        tags: ['parken', 'zugeparkt', 'falschparker', 'zweite-reihe'],
      },
      {
        id: 'signage',
        icon: 'ğŸª§',
        label: 'Wegweisung',
        description: 'Fehlend, beschÃ¤digt, verwirrend',
        tags: ['schild', 'wegweisung', 'beschilderung', 'markierung'],
      },
      {
        id: 'lighting',
        icon: 'ğŸ’¡',
        label: 'Beleuchtung',
        description: 'Fehlend, defekt, unzureichend',
        tags: ['licht', 'dunkel', 'laterne', 'beleuchtung'],
      },
      {
        id: 'winter',
        icon: 'â„ï¸',
        label: 'Winterdienst / Reinigung',
        description: 'Nicht gerÃ¤umt, Laub, Scherben, Verschmutzung',
        tags: ['winter', 'schnee', 'eis', 'laub', 'glas', 'dreck'],
      },
      {
        id: 'barrier_free',
        icon: 'â™¿',
        label: 'Barrierefreiheit',
        description: 'Hohe Bordsteine, fehlende Absenkung, Umlaufsperren',
        tags: ['bordstein', 'absenkung', 'rampe', 'umlaufsperre', 'barriere'],
      },
      {
        id: 'other_problem',
        icon: 'â“',
        label: 'Sonstiges',
        description: 'Anderes Problem (Freitext)',
        tags: ['sonstiges'],
      },
    ],
  },

  // â”€â”€â”€ GELB: WÃ¼nsche â”€â”€â”€
  wishes: {
    id: 'wishes',
    label: 'Wunsch Ã¤uÃŸern',
    emoji: 'ğŸ’¬',
    color: '#E5A700',
    bgColor: '#FFD966',
    items: [
      {
        id: 'new_path',
        icon: 'ğŸ›¤ï¸',
        label: 'Radweg gewÃ¼nscht',
        description: 'Neue Verbindung, LÃ¼ckenschluss',
        tags: ['radweg', 'verbindung', 'lÃ¼cke', 'neu'],
      },
      {
        id: 'bike_parking',
        icon: 'ğŸ”’',
        label: 'Abstellanlage',
        description: 'FahrradbÃ¼gel, Ã¼berdacht, Ladestation',
        tags: ['abstellen', 'bÃ¼gel', 'parkplatz', 'laden'],
      },
      {
        id: 'tempo30',
        icon: 'ğŸŒ',
        label: 'Tempo 30',
        description: 'Geschwindigkeitsreduzierung gewÃ¼nscht',
        tags: ['tempo', 'geschwindigkeit', '30', 'zone'],
      },
      {
        id: 'traffic_light',
        icon: 'ğŸš¦',
        label: 'Ampelschaltung',
        description: 'GrÃ¼ne Welle, kÃ¼rzere Wartezeit, Anforderungstaster',
        tags: ['ampel', 'grÃ¼n', 'welle', 'wartezeit', 'taster'],
      },
      {
        id: 'bike_street',
        icon: 'ğŸš²',
        label: 'FahrradstraÃŸe',
        description: 'Umwidmung gewÃ¼nscht',
        tags: ['fahrradstrasse', 'fahrradzone', 'umwidmung'],
      },
      {
        id: 'oneway',
        icon: 'â†©ï¸',
        label: 'EinbahnstraÃŸe Ã¶ffnen',
        description: 'Freigabe fÃ¼r Radverkehr in Gegenrichtung',
        tags: ['einbahnstrasse', 'gegenrichtung', 'freigabe', 'Ã¶ffnen'],
      },
    ],
  },

  // â”€â”€â”€ GRÃœN: Positiv â”€â”€â”€
  positive: {
    id: 'positive',
    label: 'Lob aussprechen',
    emoji: 'ğŸ‘',
    color: '#00A836',
    bgColor: '#8FD99F',
    items: [
      {
        id: 'good_infra',
        icon: 'â­',
        label: 'Gute Infrastruktur',
        description: 'Vorbildlicher Radweg, gute LÃ¶sung',
        tags: ['gut', 'vorbild', 'radweg', 'lÃ¶sung'],
      },
      {
        id: 'safe_crossing',
        icon: 'âœ…',
        label: 'Sichere Querung',
        description: 'Gut gestaltete Kreuzung oder Ãœberweg',
        tags: ['sicher', 'kreuzung', 'querung', 'Ã¼berweg'],
      },
      {
        id: 'service',
        icon: 'ğŸ› ï¸',
        label: 'Service',
        description: 'Reparaturstation, Luftpumpe, Trinkwasser',
        tags: ['reparatur', 'pumpe', 'service', 'wasser'],
      },
    ],
  },
};

/**
 * Kategorie nach ID finden
 */
function getCategoryById(categoryId) {
  return CATEGORIES[categoryId] || null;
}

/**
 * Unterkategorie nach IDs finden
 */
function getSubcategoryById(categoryId, subcategoryId) {
  const cat = CATEGORIES[categoryId];
  if (!cat) return null;
  return cat.items.find((item) => item.id === subcategoryId) || null;
}

/**
 * Alle Kategorien als flache Liste (fÃ¼r Export)
 */
function getAllSubcategories() {
  const result = [];
  for (const [catId, cat] of Object.entries(CATEGORIES)) {
    for (const item of cat.items) {
      result.push({
        categoryId: catId,
        categoryLabel: cat.label,
        ...item,
      });
    }
  }
  return result;
}



// â•â•â• db.js â•â•â•
// â”€â”€â”€ 2Rat Radmelder â€“ Datenbank (IndexedDB via Dexie.js) â”€â”€â”€
// Dexie wird per CDN in index.html geladen

const DB_NAME = 'radmelder';
const DB_VERSION = 1;

let db;

/**
 * Datenbank initialisieren
 */
function initDB() {
  db = new Dexie(DB_NAME);

  db.version(DB_VERSION).stores({
    // Haupttabelle fÃ¼r Meldungen
    reports: '++localId, id, category, subcategory, timestamp, syncStatus',
    // Fotos separat (wegen GrÃ¶ÃŸe)
    photos: '++id, reportLocalId, data, timestamp',
    // Einstellungen
    settings: 'key',
  });

  console.log('[DB] Initialisiert');
  return db;
}

// â”€â”€â”€ REPORTS â”€â”€â”€

/**
 * Neue Meldung speichern
 * @param {Object} report - Meldungsdaten
 * @returns {number} localId
 */
async function saveReport(report) {
  const entry = {
    id: crypto.randomUUID(),
    latitude: report.latitude,
    longitude: report.longitude,
    accuracy: report.accuracy || null,
    heading: report.heading || null,
    timestamp: new Date().toISOString(),
    category: report.category,
    subcategory: report.subcategory,
    comment: report.comment || '',
    photoCount: report.photoCount || 0,
    syncStatus: 'local', // local | queued | synced
    serverId: null,
  };

  const localId = await db.reports.add(entry);
  console.log(`[DB] Meldung gespeichert: ${localId}`);
  return localId;
}

/**
 * Alle Meldungen laden
 * @returns {Array} Meldungen sortiert nach Zeitstempel (neueste zuerst)
 */
async function getAllReports() {
  return db.reports.orderBy('timestamp').reverse().toArray();
}

/**
 * Einzelne Meldung laden
 * @param {number} localId
 * @returns {Object} Meldung
 */
async function getReport(localId) {
  return db.reports.get(localId);
}

/**
 * Meldung lÃ¶schen
 * @param {number} localId
 */
async function deleteReport(localId) {
  await db.photos.where('reportLocalId').equals(localId).delete();
  await db.reports.delete(localId);
  console.log(`[DB] Meldung gelÃ¶scht: ${localId}`);
}

/**
 * Anzahl der Meldungen
 * @returns {number}
 */
async function getReportCount() {
  return db.reports.count();
}

// â”€â”€â”€ FOTOS â”€â”€â”€

/**
 * Foto zu Meldung hinzufÃ¼gen
 * @param {number} reportLocalId
 * @param {string} dataUrl - Base64-kodiertes Foto
 */
async function savePhoto(reportLocalId, dataUrl) {
  await db.photos.add({
    reportLocalId,
    data: dataUrl,
    timestamp: new Date().toISOString(),
  });
}

/**
 * Alle Fotos einer Meldung laden
 * @param {number} reportLocalId
 * @returns {Array}
 */
async function getPhotosForReport(reportLocalId) {
  return db.photos.where('reportLocalId').equals(reportLocalId).toArray();
}

// â”€â”€â”€ EINSTELLUNGEN â”€â”€â”€

/**
 * Einstellung speichern
 */
async function setSetting(key, value) {
  await db.settings.put({ key, value });
}

/**
 * Einstellung laden
 */
async function getSetting(key, defaultValue = null) {
  const entry = await db.settings.get(key);
  return entry ? entry.value : defaultValue;
}

// â”€â”€â”€ STATISTIKEN â”€â”€â”€

/**
 * Statistik-Ãœbersicht
 */
async function getStats() {
  const all = await db.reports.toArray();
  const stats = {
    total: all.length,
    problems: all.filter((r) => r.category === 'problems').length,
    wishes: all.filter((r) => r.category === 'wishes').length,
    positive: all.filter((r) => r.category === 'positive').length,
    synced: all.filter((r) => r.syncStatus === 'synced').length,
    local: all.filter((r) => r.syncStatus === 'local').length,
  };
  return stats;
}




// â•â•â• router.js â•â•â•
// â”€â”€â”€ 2Rat Radmelder â€“ Router (Screen-Navigation) â”€â”€â”€

/**
 * Einfacher Hash-basierter Router fÃ¼r Single-Page-Navigation.
 * Screens werden per CSS-Klasse ein-/ausgeblendet.
 *
 * Verwendung:
 *   initRouter({
 *     default: 'home',
 *     routes: {
 *       'home':        () => showHomeScreen(),
 *       'category':    (params) => showCategoryScreen(params),
 *       'details':     (params) => showDetailsScreen(params),
 *       'confirm':     () => showConfirmScreen(),
 *       'list':        () => showListScreen(),
 *     }
 *   });
 *
 *   navigate('category', { type: 'problems' });
 *   goBack();
 */

let routerConfig = null;
let history = [];

/**
 * Router initialisieren
 */
function initRouter(config) {
  routerConfig = config;
  history = [];

  // Hash-Ã„nderungen abfangen
  window.addEventListener('hashchange', () => {
    const screen = getScreenFromHash();
    activateScreen(screen);
  });

  // Initiales Routing
  const initial = getScreenFromHash() || config.default || 'home';
  navigate(initial);
}

/**
 * Screen-Name aus Hash extrahieren
 */
function getScreenFromHash() {
  const hash = window.location.hash.replace('#', '');
  return hash || null;
}

/**
 * Zu Screen navigieren
 * @param {string} screenId - Name des Screens
 * @param {Object} params - Optionale Parameter
 */
function navigate(screenId, params = {}) {
  // In History pushen
  history.push({ screen: screenId, params });

  // Hash aktualisieren (ohne hashchange auszulÃ¶sen)
  window.location.hash = screenId;

  // Screen aktivieren
  activateScreen(screenId, params);
}

/**
 * ZurÃ¼ck navigieren
 */
function goBack() {
  if (history.length > 1) {
    history.pop(); // Aktuellen entfernen
    const prev = history[history.length - 1];
    window.location.hash = prev.screen;
    activateScreen(prev.screen, prev.params);
  } else {
    navigate(routerConfig.default || 'home');
  }
}

/**
 * Screen aktivieren (CSS-Klasse + Callback)
 */
function activateScreen(screenId, params = {}) {
  // Alle Screens ausblenden
  document.querySelectorAll('[data-screen]').forEach((el) => {
    el.classList.remove('screen--active');
    el.setAttribute('aria-hidden', 'true');
  });

  // Ziel-Screen einblenden
  const target = document.querySelector(`[data-screen="${screenId}"]`);
  if (target) {
    target.classList.add('screen--active');
    target.setAttribute('aria-hidden', 'false');
    target.scrollTop = 0; // Scroll zurÃ¼cksetzen
  }

  // Route-Callback ausfÃ¼hren
  if (routerConfig?.routes?.[screenId]) {
    routerConfig.routes[screenId](params);
  }
}

/**
 * Aktuellen Screen abfragen
 */
function getCurrentScreen() {
  return history.length > 0 ? history[history.length - 1] : null;
}

/**
 * Hardware-ZurÃ¼ck-Button abfangen (Android)
 */
function enableBackButton() {
  window.addEventListener('popstate', (e) => {
    if (history.length > 1) {
      e.preventDefault();
      goBack();
    }
  });
}



// â•â•â• camera.js â•â•â•
// â”€â”€â”€ 2Rat Radmelder â€“ Kamera-Modul â”€â”€â”€

/**
 * Foto aufnehmen via HTML5 Input (zuverlÃ¤ssigste Methode auf Mobile)
 * Gibt ein Promise zurÃ¼ck mit Base64-Daten und Thumbnail
 *
 * @param {Object} options
 * @param {number} options.maxWidth - Max Breite in Pixel (default: 1280)
 * @param {number} options.quality - JPEG-QualitÃ¤t 0-1 (default: 0.8)
 * @returns {Promise<{dataUrl: string, thumbnail: string, width: number, height: number}>}
 */
function capturePhoto(options = {}) {
  const maxWidth = options.maxWidth || 1280;
  const quality = options.quality || 0.8;

  return new Promise((resolve, reject) => {
    // Verstecktes File-Input erstellen
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = 'image/*';
    input.capture = 'environment'; // RÃ¼ckkamera bevorzugen

    input.addEventListener('change', (event) => {
      const file = event.target.files[0];
      if (!file) {
        reject(new Error('Keine Datei ausgewÃ¤hlt'));
        return;
      }

      processImage(file, maxWidth, quality)
        .then(resolve)
        .catch(reject);
    });

    input.addEventListener('cancel', () => {
      reject(new Error('Abgebrochen'));
    });

    // Dialog Ã¶ffnen
    input.click();
  });
}

/**
 * Bild verarbeiten: Resize + Komprimierung
 */
function processImage(file, maxWidth, quality) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();

    reader.onload = (e) => {
      const img = new Image();
      img.onload = () => {
        // Resize wenn nÃ¶tig
        let width = img.width;
        let height = img.height;

        if (width > maxWidth) {
          height = Math.round(height * (maxWidth / width));
          width = maxWidth;
        }

        // Canvas fÃ¼r Komprimierung
        const canvas = document.createElement('canvas');
        canvas.width = width;
        canvas.height = height;

        const ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0, width, height);

        const dataUrl = canvas.toDataURL('image/jpeg', quality);

        // Thumbnail erstellen (200px breit)
        const thumbWidth = 200;
        const thumbHeight = Math.round(height * (thumbWidth / width));
        canvas.width = thumbWidth;
        canvas.height = thumbHeight;
        ctx.drawImage(img, 0, 0, thumbWidth, thumbHeight);
        const thumbnail = canvas.toDataURL('image/jpeg', 0.6);

        resolve({
          dataUrl,
          thumbnail,
          width,
          height,
          originalName: file.name,
          size: dataUrl.length,
        });
      };

      img.onerror = () => reject(new Error('Bild konnte nicht geladen werden'));
      img.src = e.target.result;
    };

    reader.onerror = () => reject(new Error('Datei konnte nicht gelesen werden'));
    reader.readAsDataURL(file);
  });
}

/**
 * PrÃ¼fen ob Kamera verfÃ¼gbar ist
 */
function isCameraAvailable() {
  return 'mediaDevices' in navigator && 'getUserMedia' in navigator.mediaDevices;
}



// â•â•â• map.js â•â•â•
// â”€â”€â”€ 2Rat Radmelder â€“ Kartenmodul (Leaflet + GPS) â”€â”€â”€

let map = null;
let userMarker = null;
let reportMarkers = [];
let currentPosition = null;
let watchId = null;

// Marker-Farben passend zu Kategorien (Ampel)
const MARKER_COLORS = {
  problems: '#E00000',
  wishes: '#E5A700',
  positive: '#00A836',
};

/**
 * Karte initialisieren
 * @param {string} containerId - ID des HTML-Containers
 * @param {Object} options - Optionen
 */
function initMap(containerId, options = {}) {
  const defaultCenter = [49.41, 6.78]; // Lebach, Saarland (2Rat Standort)
  const defaultZoom = 14;

  map = L.map(containerId, {
    center: options.center || defaultCenter,
    zoom: options.zoom || defaultZoom,
    zoomControl: false, // Eigene Position stattdessen
    attributionControl: true,
  });

  // OpenStreetMap Tiles
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'Â© <a href="https://openstreetmap.org">OpenStreetMap</a>',
    maxZoom: 19,
  }).addTo(map);

  // Zoom-Control rechts unten
  L.control.zoom({ position: 'bottomright' }).addTo(map);

  console.log('[Map] Initialisiert');
  return map;
}

/**
 * GPS-Tracking starten
 * @param {Function} onUpdate - Callback bei Positionsupdate
 * @param {Function} onError - Callback bei Fehler
 */
function startGPS(onUpdate, onError) {
  if (!navigator.geolocation) {
    onError && onError('GPS nicht verfÃ¼gbar');
    return;
  }

  const gpsOptions = {
    enableHighAccuracy: true,
    timeout: 15000,
    maximumAge: 5000,
  };

  // Einmalige Position holen
  navigator.geolocation.getCurrentPosition(
    (pos) => {
      handlePosition(pos, onUpdate);
    },
    (err) => {
      console.warn('[GPS] Fehler:', err.message);
      onError && onError(err.message);
    },
    gpsOptions
  );

  // Kontinuierliches Tracking
  watchId = navigator.geolocation.watchPosition(
    (pos) => handlePosition(pos, onUpdate),
    (err) => console.warn('[GPS] Watch-Fehler:', err.message),
    gpsOptions
  );
}

/**
 * GPS-Tracking stoppen
 */
function stopGPS() {
  if (watchId !== null) {
    navigator.geolocation.clearWatch(watchId);
    watchId = null;
  }
}

/**
 * Position verarbeiten
 */
function handlePosition(pos, callback) {
  currentPosition = {
    latitude: pos.coords.latitude,
    longitude: pos.coords.longitude,
    accuracy: Math.round(pos.coords.accuracy),
    heading: pos.coords.heading,
    timestamp: pos.timestamp,
  };

  // User-Marker aktualisieren
  if (map) {
    const latlng = [currentPosition.latitude, currentPosition.longitude];

    if (userMarker) {
      userMarker.setLatLng(latlng);
    } else {
      userMarker = L.circleMarker(latlng, {
        radius: 8,
        fillColor: '#1A5FA8',
        fillOpacity: 1,
        color: '#FFFFFF',
        weight: 3,
      }).addTo(map);

      // Beim ersten Fix: Karte zentrieren
      map.setView(latlng, 16);
    }

    // Genauigkeitskreis
    if (userMarker._accuracyCircle) {
      userMarker._accuracyCircle.setLatLng(latlng);
      userMarker._accuracyCircle.setRadius(currentPosition.accuracy);
    } else {
      userMarker._accuracyCircle = L.circle(latlng, {
        radius: currentPosition.accuracy,
        fillColor: '#1A5FA8',
        fillOpacity: 0.1,
        color: '#1A5FA8',
        weight: 1,
        opacity: 0.3,
      }).addTo(map);
    }
  }

  callback && callback(currentPosition);
}

/**
 * Aktuelle GPS-Position holen
 * @returns {Object|null}
 */
function getCurrentPosition() {
  return currentPosition;
}

/**
 * Karte auf Position zentrieren
 */
function centerOnPosition() {
  if (map && currentPosition) {
    map.setView([currentPosition.latitude, currentPosition.longitude], 17);
  }
}

/**
 * Meldungs-Marker auf Karte setzen
 * @param {Array} reports - Array von Meldungen aus der DB
 */
function displayReports(reports) {
  // Alte Marker entfernen
  reportMarkers.forEach((m) => map.removeLayer(m));
  reportMarkers = [];

  reports.forEach((report) => {
    if (!report.latitude || !report.longitude) return;

    const color = MARKER_COLORS[report.category] || '#5A6A72';

    const marker = L.circleMarker([report.latitude, report.longitude], {
      radius: 10,
      fillColor: color,
      fillOpacity: 0.85,
      color: '#FFFFFF',
      weight: 2,
    }).addTo(map);

    // Popup mit Infos
    marker.bindPopup(`
      <div style="font-family: sans-serif; min-width: 150px;">
        <strong>${report.subcategory || report.category}</strong><br>
        <small style="color: #888;">${new Date(report.timestamp).toLocaleString('de-DE')}</small>
        ${report.comment ? `<p style="margin: 6px 0 0; font-size: 13px;">${report.comment}</p>` : ''}
      </div>
    `);

    reportMarkers.push(marker);
  });
}

/**
 * Karte auf alle Meldungen zoomen
 */
function fitToReports() {
  if (reportMarkers.length === 0) return;
  const group = L.featureGroup(reportMarkers);
  map.fitBounds(group.getBounds().pad(0.1));
}




// â•â•â• export.js â•â•â•
// â”€â”€â”€ 2Rat Radmelder â€“ Export-Modul â”€â”€â”€


/**
 * Alle Meldungen als GeoJSON exportieren
 * @returns {Object} GeoJSON FeatureCollection
 */
async function exportGeoJSON() {
  const reports = await getAllReports();

  const features = reports.map((report) => {
    const sub = getSubcategoryById(report.category, report.subcategory);

    return {
      type: 'Feature',
      geometry: {
        type: 'Point',
        coordinates: [report.longitude, report.latitude],
      },
      properties: {
        id: report.id,
        category: report.category,
        subcategory: report.subcategory,
        categoryLabel: sub?.label || report.subcategory,
        comment: report.comment || '',
        timestamp: report.timestamp,
        accuracy: report.accuracy,
        heading: report.heading,
        photoCount: report.photoCount || 0,
        syncStatus: report.syncStatus,
      },
    };
  });

  const geojson = {
    type: 'FeatureCollection',
    name: '2Rat_Radmelder_Export',
    crs: {
      type: 'name',
      properties: {
        name: 'urn:ogc:def:crs:OGC:1.3:CRS84',
      },
    },
    features,
    metadata: {
      exportDate: new Date().toISOString(),
      app: '2Rat Radmelder',
      version: '1.0.0',
      totalReports: features.length,
    },
  };

  return geojson;
}

/**
 * Alle Meldungen als CSV exportieren
 * @returns {string} CSV-String
 */
async function exportCSV() {
  const reports = await getAllReports();

  const headers = [
    'id',
    'latitude',
    'longitude',
    'accuracy',
    'timestamp',
    'category',
    'subcategory',
    'comment',
    'photoCount',
    'syncStatus',
  ];

  const rows = reports.map((r) =>
    headers.map((h) => {
      const val = r[h] ?? '';
      // CSV-Escaping: AnfÃ¼hrungszeichen verdoppeln
      const str = String(val).replace(/"/g, '""');
      return str.includes(',') || str.includes('"') || str.includes('\n')
        ? `"${str}"`
        : str;
    }).join(',')
  );

  // BOM fÃ¼r Excel-KompatibilitÃ¤t mit Umlauten
  return '\uFEFF' + headers.join(',') + '\n' + rows.join('\n');
}

/**
 * Datei zum Download anbieten
 * @param {string} content - Dateiinhalt
 * @param {string} filename - Dateiname
 * @param {string} mimeType - MIME-Type
 */
function downloadFile(content, filename, mimeType) {
  const blob = new Blob(
    [typeof content === 'string' ? content : JSON.stringify(content, null, 2)],
    { type: mimeType }
  );

  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = filename;
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  URL.revokeObjectURL(url);

  console.log(`[Export] ${filename} heruntergeladen`);
}

/**
 * GeoJSON-Export starten
 */
async function downloadGeoJSON() {
  const geojson = await exportGeoJSON();
  const date = new Date().toISOString().split('T')[0];
  downloadFile(geojson, `radmelder_${date}.geojson`, 'application/geo+json');
}

/**
 * CSV-Export starten
 */
async function downloadCSV() {
  const csv = await exportCSV();
  const date = new Date().toISOString().split('T')[0];
  downloadFile(csv, `radmelder_${date}.csv`, 'text/csv;charset=utf-8');
}

/**
 * QGIS-Stildatei (.qml) generieren
 * Farbcodierung nach Ampel-Schema
 */
function downloadQGISStyle() {
  const qml = `<?xml version="1.0" encoding="UTF-8"?>
<qgis version="3.28" styleCategories="Symbology">
  <renderer-v2 type="categorizedSymbol" attr="category" symbollevels="0">
    <categories>
      <category symbol="0" value="problems" label="Probleme/MÃ¤ngel"/>
      <category symbol="1" value="wishes" label="WÃ¼nsche"/>
      <category symbol="2" value="positive" label="Positiv"/>
    </categories>
    <symbols>
      <symbol type="marker" name="0">
        <layer class="SimpleMarker">
          <Option type="Map">
            <Option type="QString" value="circle" name="name"/>
            <Option type="QString" value="224,0,0,220" name="color"/>
            <Option type="QString" value="3.5" name="size"/>
          </Option>
        </layer>
      </symbol>
      <symbol type="marker" name="1">
        <layer class="SimpleMarker">
          <Option type="Map">
            <Option type="QString" value="circle" name="name"/>
            <Option type="QString" value="229,167,0,220" name="color"/>
            <Option type="QString" value="3.5" name="size"/>
          </Option>
        </layer>
      </symbol>
      <symbol type="marker" name="2">
        <layer class="SimpleMarker">
          <Option type="Map">
            <Option type="QString" value="circle" name="name"/>
            <Option type="QString" value="0,168,54,220" name="color"/>
            <Option type="QString" value="3.5" name="size"/>
          </Option>
        </layer>
      </symbol>
    </symbols>
  </renderer-v2>
</qgis>`;

  downloadFile(qml, 'radmelder_stil.qml', 'application/xml');
}




// â•â•â• app.js â•â•â•
// â”€â”€â”€ 2Rat Radmelder â€“ Haupt-App â”€â”€â”€


// â”€â”€â”€ App-State â”€â”€â”€
const state = {
  selectedCategory: null,   // 'problems' | 'wishes' | 'positive'
  selectedSubcategory: null, // z.B. 'surface'
  comment: '',
  photos: [],               // Array von { dataUrl, thumbnail }
  gpsPosition: null,
  gpsAccuracy: null,
};

// â”€â”€â”€ INITIALISIERUNG â”€â”€â”€

document.addEventListener('DOMContentLoaded', async () => {
  console.log('[App] 2Rat Radmelder wird geladen...');

  // 1. Datenbank
  initDB();

  // 2. Service Worker registrieren
  registerSW();

  // 3. Karte
  initMap('map-container');

  // 4. GPS starten
  startGPS(
    (pos) => {
      state.gpsPosition = pos;
      updateGPSDisplay(pos);
    },
    (err) => {
      console.warn('[App] GPS-Fehler:', err);
      showGPSError(err);
    }
  );

  // 5. Router
  initRouter({
    default: 'home',
    routes: {
      home: onHomeScreen,
      subcategory: onSubcategoryScreen,
      details: onDetailsScreen,
      confirm: onConfirmScreen,
      list: onListScreen,
    },
  });

  // 6. Event-Listener
  bindEvents();

  // 7. Meldungsanzahl aktualisieren
  updateReportBadge();

  console.log('[App] âœ“ Bereit');
});

// â”€â”€â”€ SERVICE WORKER â”€â”€â”€

async function registerSW() {
  if ('serviceWorker' in navigator) {
    try {
      const reg = await navigator.serviceWorker.register('./sw.js');
      console.log('[SW] Registriert:', reg.scope);
    } catch (err) {
      console.warn('[SW] Registrierung fehlgeschlagen:', err);
    }
  }
}

// â”€â”€â”€ SCREEN-CALLBACKS â”€â”€â”€

async function onHomeScreen() {
  // Meldungen auf Karte anzeigen
  const reports = await getAllReports();
  displayReports(reports);
  updateReportBadge();
}

function onSubcategoryScreen(params) {
  if (params?.type) {
    state.selectedCategory = params.type;
  }
  renderSubcategories();
}

function onDetailsScreen() {
  renderDetailsForm();
}

function onConfirmScreen() {
  // Nichts zu tun â€“ statischer Screen
}

async function onListScreen() {
  renderReportList();
}

// â”€â”€â”€ RENDERING â”€â”€â”€

function renderSubcategories() {
  const cat = CATEGORIES[state.selectedCategory];
  if (!cat) return;

  const container = document.getElementById('subcategory-list');
  const title = document.getElementById('subcategory-title');

  title.textContent = cat.label;
  title.style.color = cat.color;

  container.innerHTML = cat.items
    .map(
      (item) => `
    <button class="category-card" data-sub="${item.id}" style="--accent: ${cat.color}; --accent-bg: ${cat.bgColor}; --accent-border: ${cat.color}20">
      <div class="category-card__icon" style="background:${cat.bgColor}; font-size:22px;">${item.icon}</div>
      <div class="category-card__text">
        <div class="category-card__label">${item.label}</div>
        <div class="category-card__desc">${item.description}</div>
      </div>
      <div class="category-card__arrow">â€º</div>
    </button>
  `
    )
    .join('');

  // Click-Handler
  container.querySelectorAll('.category-card').forEach((btn) => {
    btn.addEventListener('click', () => {
      state.selectedSubcategory = btn.dataset.sub;
      navigate('details');
    });
  });
}

let detailMap = null;
let detailMarker = null;

function renderDetailsForm() {
  const sub = getSubcategoryById(state.selectedCategory, state.selectedSubcategory);
  if (!sub) return;

  document.getElementById('detail-title').textContent = `${sub.icon} ${sub.label}`;
  document.getElementById('detail-description').textContent = sub.description;
  document.getElementById('comment-input').value = state.comment;

  // Detail-Karte initialisieren
  setTimeout(() => {
    const container = document.getElementById('detail-map');
    if (!container) return;
    
    // Alte Karte entfernen
    if (detailMap) {
      detailMap.remove();
      detailMap = null;
    }

    const pos = getCurrentPosition();
    const center = pos ? [pos.latitude, pos.longitude] : [49.41, 6.78];
    const zoom = pos ? 17 : 14;

    detailMap = L.map('detail-map', {
      center: center,
      zoom: zoom,
      zoomControl: false,
      dragging: true,
      scrollWheelZoom: false,
    });

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap',
      maxZoom: 19,
    }).addTo(detailMap);

    // Marker fÃ¼r aktuelle Position
    if (pos) {
      detailMarker = L.marker(center, {
        draggable: true,
      }).addTo(detailMap);

      // Wenn Marker verschoben wird, Position updaten
      detailMarker.on('dragend', function(e) {
        const latlng = e.target.getLatLng();
        state.gpsPosition = {
          ...state.gpsPosition,
          latitude: latlng.lat,
          longitude: latlng.lng,
          accuracy: 0, // Manuell gesetzt
        };
        const gpsInfo = document.getElementById('detail-gps-info');
        if (gpsInfo) {
          gpsInfo.textContent = `ğŸ“ Manuell gesetzt Â· ${latlng.lat.toFixed(5)}, ${latlng.lng.toFixed(5)}`;
        }
      });
    }

    // Karte neu layouten (wichtig nach Screen-Wechsel)
    setTimeout(() => detailMap.invalidateSize(), 100);
  }, 150);

  // GPS-Anzeige aktualisieren
  if (state.gpsPosition) {
    updateGPSDisplay(state.gpsPosition);
    const gpsInfo = document.getElementById('detail-gps-info');
    if (gpsInfo) {
      gpsInfo.textContent = `GPS: Â±${state.gpsPosition.accuracy}m Â· ${state.gpsPosition.latitude.toFixed(5)}, ${state.gpsPosition.longitude.toFixed(5)}`;
    }
  }

  // Fotos anzeigen
  renderPhotoPreview();
}

function renderPhotoPreview() {
  const container = document.getElementById('photo-preview');
  container.innerHTML =
    state.photos
      .map(
        (p, i) => `
    <div class="photo-thumb">
      <img src="${p.thumbnail}" alt="Foto ${i + 1}">
      <button class="photo-thumb__remove" data-index="${i}">Ã—</button>
    </div>
  `
      )
      .join('') +
    `<button id="btn-add-photo" class="photo-add">
      <span>+</span>
      <small>Foto</small>
    </button>`;

  // Event-Handler
  document.getElementById('btn-add-photo')?.addEventListener('click', handleAddPhoto);
  container.querySelectorAll('.photo-thumb__remove').forEach((btn) => {
    btn.addEventListener('click', () => {
      state.photos.splice(parseInt(btn.dataset.index), 1);
      renderPhotoPreview();
    });
  });
}

async function renderReportList() {
  const reports = await getAllReports();
  const container = document.getElementById('report-list');

  if (reports.length === 0) {
    container.innerHTML = `
      <div class="empty-state">
        <div class="empty-state__icon">ğŸ—ºï¸</div>
        <p>Noch keine Meldungen vorhanden.</p>
        <button onclick="window.location.hash='home'" style="margin-top:16px; background:linear-gradient(135deg,#1A5FA8,#2D8C28); color:#fff; border:none; border-radius:14px; padding:14px 28px; font-size:15px; font-weight:700; cursor:pointer; box-shadow:0 4px 16px rgba(26,95,168,0.3);">
          + Erste Meldung erstellen
        </button>
      </div>`;
    return;
  }

  container.innerHTML = reports
    .map((r) => {
      const cat = CATEGORIES[r.category];
      const sub = getSubcategoryById(r.category, r.subcategory);
      const date = new Date(r.timestamp).toLocaleString('de-DE');

      return `
      <div class="report-item" style="--cat-bg: ${cat?.bgColor || '#f0f0f0'}">
        <div class="report-item__icon" style="background: ${cat?.bgColor}">${sub?.icon || 'ğŸ“'}</div>
        <div class="report-item__text">
          <div class="report-item__label">${sub?.label || r.subcategory}</div>
          <div class="report-item__meta">${date} Â· ${r.photoCount ? 'ğŸ“· ' + r.photoCount : 'Kein Foto'}</div>
          ${r.comment ? `<div class="report-item__comment">â€${r.comment.substring(0, 60)}${r.comment.length > 60 ? '...' : ''}"</div>` : ''}
        </div>
        <button class="report-item__delete" data-id="${r.localId}" title="LÃ¶schen">ğŸ—‘ï¸</button>
      </div>`;
    })
    .join('');

  // LÃ¶schen-Handler
  container.querySelectorAll('.report-item__delete').forEach((btn) => {
    btn.addEventListener('click', async () => {
      if (confirm('Meldung wirklich lÃ¶schen?')) {
        await deleteReport(parseInt(btn.dataset.id));
        renderReportList();
        updateReportBadge();
      }
    });
  });
}

// â”€â”€â”€ EVENT-HANDLER â”€â”€â”€

function bindEvents() {
  // Hauptkategorien
  document.querySelectorAll('[data-category]').forEach((btn) => {
    btn.addEventListener('click', () => {
      state.selectedCategory = btn.dataset.category;
      state.selectedSubcategory = null;
      state.comment = '';
      state.photos = [];
      navigate('subcategory', { type: btn.dataset.category });
    });
  });

  // ZurÃ¼ck-Buttons
  document.querySelectorAll('[data-back]').forEach((btn) => {
    btn.addEventListener('click', goBack);
  });

  // Meldung speichern
  document.getElementById('btn-save-report')?.addEventListener('click', handleSaveReport);

  // Meine Meldungen
  document.getElementById('btn-my-reports')?.addEventListener('click', () => navigate('list'));

  // GPS zentrieren
  document.getElementById('btn-center-gps')?.addEventListener('click', centerOnPosition);

  // Neue Meldung (nach BestÃ¤tigung)
  document.getElementById('btn-new-report')?.addEventListener('click', () => navigate('home'));

  // Export-Buttons
  document.getElementById('btn-export-geojson')?.addEventListener('click', downloadGeoJSON);
  document.getElementById('btn-export-csv')?.addEventListener('click', downloadCSV);
  document.getElementById('btn-export-qgis')?.addEventListener('click', downloadQGISStyle);

  // Kommentar speichern bei Eingabe
  document.getElementById('comment-input')?.addEventListener('input', (e) => {
    state.comment = e.target.value;
  });
}

// â”€â”€â”€ AKTIONEN â”€â”€â”€

async function handleAddPhoto() {
  if (state.photos.length >= 3) {
    showToast('Maximal 3 Fotos');
    return;
  }

  try {
    const photo = await capturePhoto({ maxWidth: 1280, quality: 0.8 });
    state.photos.push(photo);
    renderPhotoPreview();
    showToast('ğŸ“· Foto hinzugefÃ¼gt');
  } catch (err) {
    if (err.message !== 'Abgebrochen') {
      showToast('Foto konnte nicht aufgenommen werden');
    }
  }
}

async function handleSaveReport() {
  const pos = getCurrentPosition();

  if (!pos) {
    showToast('âš ï¸ Kein GPS-Signal â€“ bitte warten');
    return;
  }

  // Meldung speichern
  const localId = await saveReport({
    latitude: pos.latitude,
    longitude: pos.longitude,
    accuracy: pos.accuracy,
    heading: pos.heading,
    category: state.selectedCategory,
    subcategory: state.selectedSubcategory,
    comment: state.comment,
    photoCount: state.photos.length,
  });

  // Fotos speichern
  for (const photo of state.photos) {
    await savePhoto(localId, photo.dataUrl);
  }

  // State zurÃ¼cksetzen
  state.selectedCategory = null;
  state.selectedSubcategory = null;
  state.comment = '';
  state.photos = [];

  navigate('confirm');
}

// â”€â”€â”€ UI-HELPER â”€â”€â”€

function updateGPSDisplay(pos) {
  const el = document.getElementById('gps-status');
  if (el) {
    el.innerHTML = `<span class="gps-dot"></span> GPS Â±${pos.accuracy}m`;
    el.classList.toggle('gps-status--good', pos.accuracy <= 10);
    el.classList.toggle('gps-status--ok', pos.accuracy > 10 && pos.accuracy <= 30);
    el.classList.toggle('gps-status--poor', pos.accuracy > 30);
  }
}

function showGPSError(msg) {
  const el = document.getElementById('gps-status');
  if (el) {
    el.innerHTML = `<span class="gps-dot gps-dot--error"></span> Kein GPS`;
  }
}

async function updateReportBadge() {
  const count = await getReportCount();
  const badge = document.getElementById('report-badge');
  if (badge) {
    badge.textContent = count;
    badge.style.display = count > 0 ? 'flex' : 'none';
  }
}

let toastTimeout;
function showToast(message) {
  let toast = document.getElementById('toast');
  if (!toast) {
    toast = document.createElement('div');
    toast.id = 'toast';
    toast.className = 'toast';
    document.body.appendChild(toast);
  }

  toast.textContent = message;
  toast.classList.add('toast--visible');

  clearTimeout(toastTimeout);
  toastTimeout = setTimeout(() => {
    toast.classList.remove('toast--visible');
  }, 2500);
}

</script>
</body>
</html>